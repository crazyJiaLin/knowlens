# Knowlens æŠ€æœ¯æ–¹æ¡ˆæ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

Knowlens æ˜¯ä¸€æ¬¾åŸºäº AI çš„çŸ¥è¯†æ´å¯ŸåŠ©æ‰‹ï¼Œå¸®åŠ©ç”¨æˆ·ä»è§†é¢‘ã€PDF ç­‰é•¿æ–‡æœ¬å†…å®¹ä¸­è‡ªåŠ¨æç‚¼çŸ¥è¯†ç‚¹å¹¶ç”Ÿæˆæ·±åº¦æ´å¯Ÿã€‚

**é¢„è®¡ç”¨æˆ·è§„æ¨¡**ï¼šæ—¥æ´» 1000
**éƒ¨ç½²ç¯å¢ƒ**ï¼šé˜¿é‡Œäº‘
**å¼€å‘å‘¨æœŸé¢„ä¼°**ï¼š8-10å‘¨

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ¶æ„æ¨¡å¼ï¼šå‰åç«¯åˆ†ç¦»æ¶æ„

æœ¬é¡¹ç›®é‡‡ç”¨ **React + Ant Design (å‰ç«¯) + Nest.js (åç«¯)** çš„å‰åç«¯åˆ†ç¦»æ¶æ„ï¼ŒèŒè´£æ¸…æ™°ï¼Œä¾¿äºå›¢é˜Ÿåä½œå’Œç‹¬ç«‹æ‰©å±•ã€‚

#### æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ç”¨æˆ·æµè§ˆå™¨                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ HTTP/HTTPS
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Nginxï¼ˆé™æ€æ–‡ä»¶ + åå‘ä»£ç†ï¼‰           â”‚
â”‚         - å‰ç«¯é™æ€èµ„æºï¼ˆReact Buildï¼‰          â”‚
â”‚         - API åå‘ä»£ç† â†’ åç«¯æœåŠ¡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       React å‰ç«¯åº”ç”¨ï¼ˆSPAï¼‰                   â”‚
â”‚       - é¡µé¢æ¸²æŸ“å’Œäº¤äº’                        â”‚
â”‚       - çŠ¶æ€ç®¡ç†ï¼ˆzustandï¼‰                   â”‚
â”‚       - UIç»„ä»¶ï¼ˆAnt Designï¼‰                 â”‚
â”‚       - API è¯·æ±‚ï¼ˆAxiosï¼‰                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚ RESTful API
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Nest.js åç«¯æœåŠ¡                        â”‚
â”‚       - RESTful API æ¥å£                     â”‚
â”‚       - ä¸šåŠ¡é€»è¾‘å¤„ç†                          â”‚
â”‚       - ç”¨æˆ·è®¤è¯å’Œæƒé™                        â”‚
â”‚       - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†ï¼ˆBullMQï¼‰                 â”‚
â”‚       - å¿«é€Ÿä»»åŠ¡ï¼ˆæ´å¯Ÿç”Ÿæˆï¼Œ3-10ç§’ï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ BullMQï¼ˆRedis æ¶ˆæ¯é˜Ÿåˆ—ï¼‰
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       Worker è¿›ç¨‹ï¼ˆNest.js Processorï¼‰        â”‚
â”‚       - è§†é¢‘å­—å¹•è·å– & è¯­éŸ³è½¬å½•                â”‚
â”‚       - PDF æ–‡æœ¬æå–                         â”‚
â”‚       - AI çŸ¥è¯†ç‚¹æ‰¹é‡ç”Ÿæˆ                     â”‚
â”‚       - é•¿æ—¶é—´è¿è¡Œä»»åŠ¡ï¼ˆ5-30åˆ†é’Ÿï¼‰             â”‚
â”‚       - å¯æ°´å¹³æ‰©å±•ï¼ˆå¤šå®ä¾‹ï¼‰                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              å…±äº«æœåŠ¡å±‚                       â”‚
â”‚   - MongoDBï¼ˆæ•°æ®æŒä¹…åŒ–ï¼‰                     â”‚
â”‚   - Redisï¼ˆä»»åŠ¡é˜Ÿåˆ— + ç¼“å­˜ï¼‰                  â”‚
â”‚   - é˜¿é‡Œäº‘ OSSï¼ˆæ–‡ä»¶å­˜å‚¨ï¼‰                    â”‚
â”‚   - Moonshot AIï¼ˆçŸ¥è¯†ç‚¹ç”Ÿæˆ + æ´å¯Ÿï¼‰          â”‚
â”‚   - ç§‘å¤§è®¯é£ï¼ˆè¯­éŸ³è¯†åˆ«ï¼‰                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1. æŠ€æœ¯æ ˆ

#### å‰ç«¯åº”ç”¨ï¼ˆReact SPAï¼‰
- **æ¡†æ¶**ï¼šReact 18+
- **è¯­è¨€**ï¼šTypeScript
- **UIç»„ä»¶åº“**ï¼šAnt Design 5.x
- **çŠ¶æ€ç®¡ç†**ï¼šzustand
- **è·¯ç”±**ï¼šReact Router v6
- **HTTPå®¢æˆ·ç«¯**ï¼šAxios
- **è¡¨å•å¤„ç†**ï¼šAnt Design Formï¼ˆå†…ç½®éªŒè¯ï¼‰
- **æ ·å¼æ–¹æ¡ˆ**ï¼šCSS Modules / Styled Components
- **æ„å»ºå·¥å…·**ï¼šVite
- **èŒè´£**ï¼š
  - ç”¨æˆ·ç•Œé¢æ¸²æŸ“å’Œäº¤äº’
  - å‰ç«¯è·¯ç”±ç®¡ç†
  - çŠ¶æ€ç®¡ç†
  - API è¯·æ±‚å°è£…

#### åç«¯æœåŠ¡ï¼ˆNest.jsï¼‰
- **æ¡†æ¶**ï¼šNest.js 10+
- **è¯­è¨€**ï¼šTypeScript
- **æ¶æ„**ï¼šæ¨¡å—åŒ– + ä¾èµ–æ³¨å…¥
- **HTTPæ¡†æ¶**ï¼šExpressï¼ˆé»˜è®¤ï¼‰æˆ– Fastify
- **APIæ–‡æ¡£**ï¼šSwagger (OpenAPI)
- **èŒè´£**ï¼š
  - RESTful API æ¥å£
  - ä¸šåŠ¡é€»è¾‘å¤„ç†
  - æ•°æ®éªŒè¯å’Œè½¬æ¢ï¼ˆDTO + Pipeï¼‰
  - ç”¨æˆ·è®¤è¯å’Œæˆæƒï¼ˆJWTï¼‰
  - ä»»åŠ¡é˜Ÿåˆ—ç®¡ç†
  - å¿«é€ŸåŒæ­¥ä»»åŠ¡å¤„ç†

#### Worker æœåŠ¡ï¼ˆNest.js Processorï¼‰
- **åŸºäº**ï¼šNest.js + BullMQ
- **è¿è¡Œæ–¹å¼**ï¼šç‹¬ç«‹è¿›ç¨‹æˆ–ä¸ä¸»åº”ç”¨å…±è¿›ç¨‹
- **èŒè´£**ï¼š
  - è§†é¢‘å­—å¹•è·å–å’Œè¯­éŸ³è½¬å½•ï¼ˆ5-30åˆ†é’Ÿï¼‰
  - PDF æ–‡æœ¬æå–ï¼ˆ10ç§’-2åˆ†é’Ÿï¼‰
  - AI çŸ¥è¯†ç‚¹æ‰¹é‡ç”Ÿæˆï¼ˆ10-30ç§’ï¼‰
  - æ‰€æœ‰è€—æ—¶çš„å¼‚æ­¥ä»»åŠ¡å¤„ç†
- **ç‰¹ç‚¹**ï¼š
  - ç‹¬ç«‹æ‰©å±•ï¼ˆå¯å¯åŠ¨å¤šä¸ªå®ä¾‹ï¼‰
  - å¤±è´¥è‡ªåŠ¨é‡è¯•
  - ä»»åŠ¡æŒä¹…åŒ–ï¼ˆRedisï¼‰

#### æ•°æ®åº“
- **ä¸»æ•°æ®åº“**ï¼šMongoDB 6.0+
- **ODM**ï¼šMongoose + @nestjs/mongoose
- **ç¼“å­˜ + é˜Ÿåˆ—**ï¼šRedis 7.0+
  - ä»»åŠ¡é˜Ÿåˆ—ï¼ˆBullMQï¼‰- å¿…éœ€ï¼Œç”¨äºå¼‚æ­¥ä»»åŠ¡å¤„ç†
  - **æ³¨æ„**ï¼šMVPé˜¶æ®µæ´å¯Ÿå’ŒéªŒè¯ç ä½¿ç”¨MongoDBå­˜å‚¨ï¼Œæ— éœ€Redisç¼“å­˜

#### å­˜å‚¨æœåŠ¡
- **æ–‡ä»¶å­˜å‚¨**ï¼šé˜¿é‡Œäº‘OSS
- **å­˜å‚¨å†…å®¹**ï¼šä¸Šä¼ çš„PDFæ–‡ä»¶ã€ç”¨æˆ·å¤´åƒç­‰

#### AI/è¯­éŸ³æœåŠ¡
- **LLMæ¨¡å‹**ï¼šMoonshot Kimi K2 Thinking
- **è¯­éŸ³è¯†åˆ«**ï¼šç§‘å¤§è®¯é£è¯­éŸ³è½¬å†™API
- **PDFè½¬æ–‡æœ¬**ï¼špdf-parseï¼ˆå¼€æºï¼‰æˆ–é˜¿é‡Œäº‘æ–‡æ¡£è§£æ

#### è®¤è¯æˆæƒ
- **çŸ­ä¿¡æœåŠ¡**ï¼šé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
- **è®¤è¯æ–¹å¼**ï¼šJWT (JSON Web Token)
- **æˆæƒ**ï¼šRBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰

#### éƒ¨ç½²ï¼ˆè¯¦è§ã€Šéƒ¨ç½²è¯´æ˜æ–‡æ¡£ã€‹ï¼‰
- **æµ‹è¯•ç¯å¢ƒ**ï¼šå•å° ECSï¼ˆ2æ ¸4Gï¼‰ï¼Œå‰åç«¯åŒæœºéƒ¨ç½²
- **ç”Ÿäº§ç¯å¢ƒ**ï¼šå‰åç«¯åˆ†ç¦»éƒ¨ç½²
  - å‰ç«¯ï¼šNginx æ‰˜ç®¡é™æ€æ–‡ä»¶ + CDNåŠ é€Ÿ
  - åç«¯ï¼šç‹¬ç«‹ ECSï¼Œå¯è´Ÿè½½å‡è¡¡
  - Workerï¼šç‹¬ç«‹ ECSï¼Œå¯å¤šå®ä¾‹
- **å®¹å™¨åŒ–**ï¼šDocker + Docker Compose
- **åå‘ä»£ç†**ï¼šNginx
- **è¿›ç¨‹ç®¡ç†**ï¼šPM2
- **åŸŸåå¤‡æ¡ˆ**ï¼šéœ€å®ŒæˆICPå¤‡æ¡ˆ

---

## ğŸ¨ è®¾è®¡ç³»ç»Ÿ - ä¸»é¢˜é¢œè‰²

### ä¸»é¢˜è‰²æ¿

åŸºäºé¦–è¦ä¸»é¢˜è‰² `#3BAF9F`ï¼ˆé’ç»¿è‰²ï¼‰ï¼Œè®¾è®¡äº†ä¸€å¥—å®Œæ•´çš„ä¸»é¢˜é¢œè‰²ç³»ç»Ÿï¼Œç¡®ä¿è§†è§‰ä¸€è‡´æ€§å’Œè‰¯å¥½çš„ç”¨æˆ·ä½“éªŒã€‚

#### ä¸»è‰²è°ƒï¼ˆPrimaryï¼‰

| é¢œè‰²åç§° | è‰²å€¼ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|------|
| **Primary** | `#3BAF9F` | ä¸»è¦æ“ä½œæŒ‰é’®ã€é“¾æ¥ã€å¼ºè°ƒå…ƒç´  | é¦–è¦ä¸»é¢˜è‰²ï¼Œé’ç»¿è‰²è°ƒï¼Œä¼ è¾¾çŸ¥è¯†ã€æˆé•¿ã€ä¸“ä¸šæ„Ÿ |
| Primary Light | `#5BC4B5` | æ‚¬åœçŠ¶æ€ã€æ¬¡è¦æŒ‰é’® | ä¸»è‰²æµ…è‰²å˜ä½“ï¼Œæå‡äº¤äº’åé¦ˆ |
| Primary Lighter | `#7DD4C7` | èƒŒæ™¯é«˜äº®ã€æ ‡ç­¾èƒŒæ™¯ | æ›´æµ…çš„å˜ä½“ï¼Œç”¨äºèƒŒæ™¯è‰² |
| Primary Lightest | `#E6F7F5` | æµ…è‰²èƒŒæ™¯ã€å¡ç‰‡èƒŒæ™¯ | æœ€æµ…å˜ä½“ï¼Œç”¨äºå¤§é¢ç§¯èƒŒæ™¯ |
| Primary Dark | `#2A8F82` | æŒ‰é’®æŒ‰ä¸‹çŠ¶æ€ | ä¸»è‰²æ·±è‰²å˜ä½“ |
| Primary Darker | `#1F6B60` | æ·±è‰²æ¨¡å¼ä¸»è‰² | æ·±è‰²æ¨¡å¼ä¸‹ä½¿ç”¨ |

#### è¾…åŠ©è‰²è°ƒï¼ˆSecondaryï¼‰

| é¢œè‰²åç§° | è‰²å€¼ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|------|
| **Secondary** | `#6B8E9F` | æ¬¡è¦æ“ä½œã€è¾…åŠ©æŒ‰é’® | æŸ”å’Œçš„è“ç°è‰²è°ƒï¼Œä½è°ƒä¸æŠ¢ä¸»è‰²é£å¤´ |
| Secondary Light | `#8BA5B3` | æ‚¬åœçŠ¶æ€ | è¾…åŠ©è‰²æµ…è‰²å˜ä½“ |
| Secondary Lighter | `#B0C4D1` | èƒŒæ™¯è‰² | è¾…åŠ©è‰²èƒŒæ™¯å˜ä½“ |
| Secondary Lightest | `#E8F0F4` | æµ…è‰²èƒŒæ™¯ | è¾…åŠ©è‰²æœ€æµ…å˜ä½“ |

#### ä¸­æ€§è‰²è°ƒï¼ˆNeutralï¼‰

| é¢œè‰²åç§° | è‰²å€¼ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|------|
| **Text Primary** | `#1A1A1A` | ä¸»è¦æ–‡æœ¬ | æ·±ç°è‰²ï¼Œç”¨äºæ ‡é¢˜ã€æ­£æ–‡ |
| **Text Secondary** | `#666666` | æ¬¡è¦æ–‡æœ¬ | ä¸­ç°è‰²ï¼Œç”¨äºè¾…åŠ©ä¿¡æ¯ |
| **Text Tertiary** | `#999999` | ä¸‰çº§æ–‡æœ¬ | æµ…ç°è‰²ï¼Œç”¨äºå ä½ç¬¦ã€ç¦ç”¨æ–‡æœ¬ |
| **Text Disabled** | `#CCCCCC` | ç¦ç”¨æ–‡æœ¬ | æœ€æµ…ç°è‰² |
| **Border** | `#E0E0E0` | è¾¹æ¡†ã€åˆ†å‰²çº¿ | æµ…ç°è‰²è¾¹æ¡† |
| **Background** | `#FFFFFF` | ä¸»èƒŒæ™¯ | ç™½è‰²èƒŒæ™¯ |
| **Background Secondary** | `#F5F5F5` | æ¬¡è¦èƒŒæ™¯ | æµ…ç°èƒŒæ™¯ï¼Œç”¨äºå¡ç‰‡ã€åŒºå— |
| **Background Tertiary** | `#FAFAFA` | ä¸‰çº§èƒŒæ™¯ | æ›´æµ…çš„èƒŒæ™¯è‰² |

#### çŠ¶æ€è‰²è°ƒï¼ˆStatusï¼‰

| é¢œè‰²åç§° | è‰²å€¼ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|------|
| **Success** | `#52C41A` | æˆåŠŸçŠ¶æ€ã€æˆåŠŸæç¤º | ç»¿è‰²ï¼Œè¡¨ç¤ºæˆåŠŸã€å®Œæˆ |
| Success Light | `#B7EB8F` | æˆåŠŸèƒŒæ™¯ | æµ…ç»¿è‰²èƒŒæ™¯ |
| Success Lightest | `#F6FFED` | æˆåŠŸæµ…èƒŒæ™¯ | æœ€æµ…ç»¿è‰²èƒŒæ™¯ |
| **Warning** | `#FAAD14` | è­¦å‘ŠçŠ¶æ€ã€è­¦å‘Šæç¤º | æ©™è‰²ï¼Œè¡¨ç¤ºè­¦å‘Šã€æ³¨æ„ |
| Warning Light | `#FFE58F` | è­¦å‘ŠèƒŒæ™¯ | æµ…æ©™è‰²èƒŒæ™¯ |
| Warning Lightest | `#FFFBE6` | è­¦å‘Šæµ…èƒŒæ™¯ | æœ€æµ…æ©™è‰²èƒŒæ™¯ |
| **Error** | `#FF4D4F` | é”™è¯¯çŠ¶æ€ã€é”™è¯¯æç¤º | çº¢è‰²ï¼Œè¡¨ç¤ºé”™è¯¯ã€å¤±è´¥ |
| Error Light | `#FFA39E` | é”™è¯¯èƒŒæ™¯ | æµ…çº¢è‰²èƒŒæ™¯ |
| Error Lightest | `#FFF1F0` | é”™è¯¯æµ…èƒŒæ™¯ | æœ€æµ…çº¢è‰²èƒŒæ™¯ |
| **Info** | `#3BAF9F` | ä¿¡æ¯æç¤º | ä½¿ç”¨ä¸»è‰²è°ƒï¼Œè¡¨ç¤ºä¿¡æ¯ã€æç¤º |
| Info Light | `#7DD4C7` | ä¿¡æ¯èƒŒæ™¯ | ä¸»è‰²æµ…è‰²å˜ä½“èƒŒæ™¯ |
| Info Lightest | `#E6F7F5` | ä¿¡æ¯æµ…èƒŒæ™¯ | ä¸»è‰²æœ€æµ…å˜ä½“èƒŒæ™¯ |

#### ç‰¹æ®Šç”¨é€”è‰²

| é¢œè‰²åç§° | è‰²å€¼ | ç”¨é€” | è¯´æ˜ |
|---------|------|------|------|
| **Link** | `#3BAF9F` | é“¾æ¥æ–‡å­— | ä½¿ç”¨ä¸»è‰²ä½œä¸ºé“¾æ¥è‰² |
| Link Hover | `#2A8F82` | é“¾æ¥æ‚¬åœ | ä¸»è‰²æ·±è‰²å˜ä½“ |
| **Highlight** | `#FFF9C4` | æ–‡æœ¬é«˜äº® | é»„è‰²é«˜äº®ï¼Œç”¨äºçŸ¥è¯†ç‚¹æ ‡è®° |
| **Shadow** | `rgba(0, 0, 0, 0.1)` | é˜´å½± | å¡ç‰‡ã€æŒ‰é’®é˜´å½± |

### Ant Design ä¸»é¢˜é…ç½®

åœ¨ Ant Design 5.x ä¸­é…ç½®ä¸»é¢˜è‰²ï¼š

```typescript
// frontend/src/config/theme.ts
import { ThemeConfig } from 'antd';

export const themeConfig: ThemeConfig = {
  token: {
    // ä¸»è‰²
    colorPrimary: '#3BAF9F',
    colorSuccess: '#52C41A',
    colorWarning: '#FAAD14',
    colorError: '#FF4D4F',
    colorInfo: '#3BAF9F',
    
    // æ–‡æœ¬è‰²
    colorText: '#1A1A1A',
    colorTextSecondary: '#666666',
    colorTextTertiary: '#999999',
    colorTextDisabled: '#CCCCCC',
    
    // èƒŒæ™¯è‰²
    colorBgContainer: '#FFFFFF',
    colorBgElevated: '#F5F5F5',
    colorBgLayout: '#FAFAFA',
    
    // è¾¹æ¡†è‰²
    colorBorder: '#E0E0E0',
    colorBorderSecondary: '#F0F0F0',
    
    // é“¾æ¥è‰²
    colorLink: '#3BAF9F',
    colorLinkHover: '#2A8F82',
    
    // åœ†è§’
    borderRadius: 6,
    borderRadiusLG: 8,
    borderRadiusSM: 4,
    
    // å­—ä½“
    fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif',
    fontSize: 14,
    fontSizeLG: 16,
    fontSizeSM: 12,
    
    // é˜´å½±
    boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
    boxShadowSecondary: '0 1px 4px rgba(0, 0, 0, 0.08)',
  },
  components: {
    Button: {
      primaryColor: '#FFFFFF',
      borderRadius: 6,
    },
    Card: {
      borderRadius: 8,
      boxShadow: '0 2px 8px rgba(0, 0, 0, 0.1)',
    },
    Input: {
      borderRadius: 6,
    },
    Tag: {
      borderRadius: 4,
    },
  },
};
```

### CSS å˜é‡å®šä¹‰

åœ¨å…¨å±€ CSS ä¸­å®šä¹‰é¢œè‰²å˜é‡ï¼Œä¾¿äºåœ¨ CSS Modules å’Œ Styled Components ä¸­ä½¿ç”¨ï¼š

```css
/* frontend/src/styles/variables.css */
:root {
  /* ä¸»è‰²è°ƒ */
  --color-primary: #3BAF9F;
  --color-primary-light: #5BC4B5;
  --color-primary-lighter: #7DD4C7;
  --color-primary-lightest: #E6F7F5;
  --color-primary-dark: #2A8F82;
  --color-primary-darker: #1F6B60;
  
  /* è¾…åŠ©è‰²è°ƒ */
  --color-secondary: #6B8E9F;
  --color-secondary-light: #8BA5B3;
  --color-secondary-lighter: #B0C4D1;
  --color-secondary-lightest: #E8F0F4;
  
  /* ä¸­æ€§è‰²è°ƒ */
  --color-text-primary: #1A1A1A;
  --color-text-secondary: #666666;
  --color-text-tertiary: #999999;
  --color-text-disabled: #CCCCCC;
  --color-border: #E0E0E0;
  --color-background: #FFFFFF;
  --color-background-secondary: #F5F5F5;
  --color-background-tertiary: #FAFAFA;
  
  /* çŠ¶æ€è‰²è°ƒ */
  --color-success: #52C41A;
  --color-success-light: #B7EB8F;
  --color-success-lightest: #F6FFED;
  --color-warning: #FAAD14;
  --color-warning-light: #FFE58F;
  --color-warning-lightest: #FFFBE6;
  --color-error: #FF4D4F;
  --color-error-light: #FFA39E;
  --color-error-lightest: #FFF1F0;
  --color-info: #3BAF9F;
  --color-info-light: #7DD4C7;
  --color-info-lightest: #E6F7F5;
  
  /* ç‰¹æ®Šç”¨é€” */
  --color-link: #3BAF9F;
  --color-link-hover: #2A8F82;
  --color-highlight: #FFF9C4;
  --color-shadow: rgba(0, 0, 0, 0.1);
}
```

### ä½¿ç”¨ç¤ºä¾‹

#### åœ¨ Ant Design ç»„ä»¶ä¸­ä½¿ç”¨

```typescript
// frontend/src/main.tsx
import { ConfigProvider } from 'antd';
import { themeConfig } from './config/theme';

function App() {
  return (
    <ConfigProvider theme={themeConfig}>
      {/* åº”ç”¨å†…å®¹ */}
    </ConfigProvider>
  );
}
```

#### åœ¨ CSS Modules ä¸­ä½¿ç”¨

```css
/* frontend/src/components/Button/Button.module.css */
.primaryButton {
  background-color: var(--color-primary);
  color: white;
  border: none;
}

.primaryButton:hover {
  background-color: var(--color-primary-dark);
}
```

#### åœ¨ Styled Components ä¸­ä½¿ç”¨

```typescript
import styled from 'styled-components';

const StyledButton = styled.button`
  background-color: var(--color-primary);
  color: white;
  
  &:hover {
    background-color: var(--color-primary-dark);
  }
`;
```

### é¢œè‰²ä½¿ç”¨è§„èŒƒ

1. **ä¸»è‰²ä½¿ç”¨**ï¼š
   - ä¸»è¦æ“ä½œæŒ‰é’®ï¼ˆæäº¤ã€ç¡®è®¤ã€ä¿å­˜ç­‰ï¼‰
   - é“¾æ¥æ–‡å­—
   - é€‰ä¸­çŠ¶æ€ã€æ¿€æ´»çŠ¶æ€
   - å“ç‰Œæ ‡è¯†ã€Logo

2. **è¾…åŠ©è‰²ä½¿ç”¨**ï¼š
   - æ¬¡è¦æ“ä½œæŒ‰é’®
   - æ ‡ç­¾ã€å¾½ç« 
   - è£…é¥°æ€§å…ƒç´ 

3. **çŠ¶æ€è‰²ä½¿ç”¨**ï¼š
   - æˆåŠŸï¼šæ“ä½œæˆåŠŸã€å®ŒæˆçŠ¶æ€
   - è­¦å‘Šï¼šéœ€è¦ç”¨æˆ·æ³¨æ„çš„ä¿¡æ¯
   - é”™è¯¯ï¼šé”™è¯¯æç¤ºã€å¤±è´¥çŠ¶æ€
   - ä¿¡æ¯ï¼šä¸€èˆ¬æ€§æç¤ºä¿¡æ¯

4. **ä¸­æ€§è‰²ä½¿ç”¨**ï¼š
   - æ–‡æœ¬ï¼šæ ¹æ®é‡è¦æ€§é€‰æ‹©ä¸åŒæ·±åº¦çš„ç°è‰²
   - èƒŒæ™¯ï¼šæ ¹æ®å±‚çº§é€‰æ‹©ä¸åŒæ·±åº¦çš„èƒŒæ™¯è‰²
   - è¾¹æ¡†ï¼šç»Ÿä¸€ä½¿ç”¨æµ…ç°è‰²è¾¹æ¡†

---

## ğŸ“¦ æ ¸å¿ƒä¾èµ–åŒ…

### å‰ç«¯é¡¹ç›®ï¼ˆReact + Ant Designï¼‰

```json
{
  "name": "knowlens-frontend",
  "dependencies": {
    // React æ ¸å¿ƒ
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    
    // UI ç»„ä»¶åº“
    "antd": "^5.11.0",
    "@ant-design/icons": "^5.2.6",
    
    // çŠ¶æ€ç®¡ç†
    "zustand": "^4.4.7",
    
    // HTTP è¯·æ±‚
    "axios": "^1.6.0",
    
    // å·¥å…·åº“
    "dayjs": "^1.11.10",
    "lodash-es": "^4.17.21",
    
    // PDF æŸ¥çœ‹å™¨
    "react-pdf": "^7.5.1",
    "@react-pdf/renderer": "^3.1.14",
    
    // Markdown æ¸²æŸ“ï¼ˆç”¨äºæ´å¯Ÿå±•ç¤ºï¼‰
    "react-markdown": "^9.0.1",
    
    // å…¶ä»–
    "uuid": "^9.0.1"
  },
  "devDependencies": {
    "typescript": "^5.2.0",
    "@types/react": "^18.2.0",
    "@types/react-dom": "^18.2.0",
    "@types/lodash-es": "^4.17.12",
    
    // æ„å»ºå·¥å…·
    "vite": "^5.0.0",
    "@vitejs/plugin-react": "^4.2.0",
    
    // ä»£ç è§„èŒƒ
    "eslint": "^8.54.0",
    "prettier": "^3.1.0",
    "@typescript-eslint/eslint-plugin": "^6.13.0",
    "@typescript-eslint/parser": "^6.13.0"
  }
}
```

### åç«¯é¡¹ç›®ï¼ˆNest.jsï¼‰

```json
{
  "name": "knowlens-backend",
  "dependencies": {
    // Nest.js æ ¸å¿ƒ
    "@nestjs/common": "^10.0.0",
    "@nestjs/core": "^10.0.0",
    "@nestjs/platform-express": "^10.0.0",
    
    // MongoDB
    "@nestjs/mongoose": "^10.0.2",
    "mongoose": "^8.0.0",
    
    // Redis & ä»»åŠ¡é˜Ÿåˆ—
    "@nestjs/bullmq": "^10.0.1",
    "bullmq": "^4.15.0",
    "ioredis": "^5.3.2",
    
    // JWT è®¤è¯
    "@nestjs/jwt": "^10.2.0",
    "@nestjs/passport": "^10.0.2",
    "passport": "^0.7.0",
    "passport-jwt": "^4.0.1",
    "bcrypt": "^5.1.1",
    
    // Cookie å¤„ç†
    "cookie-parser": "^1.4.6",
    
    // é…ç½®ç®¡ç†
    "@nestjs/config": "^3.1.1",
    
    // éªŒè¯å’Œè½¬æ¢
    "class-validator": "^0.14.0",
    "class-transformer": "^0.5.1",
    
    // Swagger API æ–‡æ¡£
    "@nestjs/swagger": "^7.1.16",
    
    // é˜¿é‡Œäº‘æœåŠ¡
    "ali-oss": "^6.18.1",
    "@alicloud/dysmsapi20170525": "^3.0.0",
    
    // è§†é¢‘å­—å¹•è·å–
    "youtube-transcript": "^1.0.6",
    "axios": "^1.6.2",
    
    // PDF å¤„ç†
    "pdf-parse": "^1.1.1",
    
    // AI æœåŠ¡ï¼ˆMoonshotï¼‰
    "openai": "^4.20.0",  // Moonshot å…¼å®¹ OpenAI SDK
    
    // ç§‘å¤§è®¯é£ + éŸ³é¢‘æå–
    "ws": "^8.14.2",
    "crypto-js": "^4.2.0",
    "@distube/yt-dlp": "^1.0.4",  // è§†é¢‘éŸ³é¢‘æå–
    "form-data": "^4.0.0",        // æ–‡ä»¶ä¸Šä¼ 
    
    // å·¥å…·åº“
    "uuid": "^9.0.1",
    "dayjs": "^1.11.10",
    "lodash": "^4.17.21"
  },
  "devDependencies": {
    "@nestjs/cli": "^10.0.0",
    "@nestjs/schematics": "^10.0.0",
    
    "typescript": "^5.2.0",
    "@types/node": "^20.10.0",
    "@types/express": "^4.17.21",
    "@types/passport-jwt": "^3.0.13",
    "@types/bcrypt": "^5.0.2",
    "@types/cookie-parser": "^1.4.6",
    "@types/lodash": "^4.14.202",
    
    // ä»£ç è§„èŒƒ
    "eslint": "^8.54.0",
    "prettier": "^3.1.0",
    "@typescript-eslint/eslint-plugin": "^6.13.0",
    "@typescript-eslint/parser": "^6.13.0",
    
    // å¼€å‘å·¥å…·
    "ts-node": "^10.9.1",
    "tsconfig-paths": "^4.2.0"
  }
}
```

---

## ğŸ—„ï¸ æ•°æ®åº“è®¾è®¡ï¼ˆMongoDBï¼‰

### MongoDB Collections å’Œ Schema

#### 1. usersï¼ˆç”¨æˆ·é›†åˆï¼‰

```typescript
import mongoose from 'mongoose';

const userSchema = new mongoose.Schema({
  phone: {
    type: String,
    required: true,
    unique: true,
    index: true
    // æ‰‹æœºå·ï¼ˆä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼‰
  },
  nickname: String,
  // æ˜µç§°ï¼ˆå¯é€‰ï¼Œç”¨æˆ·å¯ä¿®æ”¹ï¼‰
  
  avatarUrl: String,
  // å¤´åƒURLï¼ˆå­˜å‚¨åœ¨é˜¿é‡Œäº‘OSSï¼‰
  
  password: {
    type: String,
    required: false,
    select: false
    // å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼Œä¸€æœŸç‰ˆæœ¬æš‚ä¸å®ç°ï¼Œé¢„ç•™å­—æ®µï¼‰
  },
  
  createdAt: {
    type: Date,
    default: Date.now
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
});

// æ•°æ®ç¤ºä¾‹
{
  "_id": "507f1f77bcf86cd799439011",
  "phone": "13800138000",
  "nickname": "å¼ ä¸‰",
  "avatarUrl": "https://oss.example.com/avatar.jpg",
  "password": null, // ä¸€æœŸç‰ˆæœ¬æš‚ä¸å®ç°ï¼Œé¢„ç•™å­—æ®µ
  "createdAt": "2025-11-10T10:00:00.000Z",
  "updatedAt": "2025-11-10T10:00:00.000Z"
}
```

#### 2. documentsï¼ˆæ–‡æ¡£é›†åˆï¼‰

```typescript
const documentSchema = new mongoose.Schema({
  userId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User',
    required: true,
    index: true
  },
  sourceType: {
    type: String,
    enum: ['video', 'pdf', 'text'],
    required: true
  },
  title: String,
  originalUrl: String,      // è§†é¢‘URLæˆ–PDF OSSåœ°å€
  status: {
    type: String,
    enum: ['processing', 'completed', 'failed'],
    required: true,
    default: 'processing',
    index: true
  },
  errorMessage: String,
  
  // è§†é¢‘ç›¸å…³å­—æ®µ
  video: {
    platform: {
      type: String,
      enum: ['youtube', 'bilibili']
    },
    videoId: String,
    duration: Number,       // è§†é¢‘æ—¶é•¿ï¼ˆç§’ï¼‰
    transcriptSource: {
      type: String,
      enum: ['native', 'asr']
      // å­—å¹•æ¥æºï¼š'native' è¡¨ç¤ºè§†é¢‘åŸç”Ÿå­—å¹•ï¼Œ'asr' è¡¨ç¤ºè‡ªåŠ¨è¯­éŸ³è¯†åˆ«ç”Ÿæˆçš„å­—å¹•
    }
  },
  
  // PDFç›¸å…³å­—æ®µ
  pdf: {
    pageCount: Number,
    fileSize: Number
  },
  
  // å…ƒæ•°æ®
  language: {
    type: String,
    default: 'zh'
  },
  wordCount: Number,
  
  createdAt: {
    type: Date,
    default: Date.now,
    index: -1  // å€’åºç´¢å¼•ï¼Œç”¨äºè®°å½•åˆ—è¡¨
  },
  updatedAt: {
    type: Date,
    default: Date.now
  }
});

// æ•°æ®ç¤ºä¾‹
{
  "_id": "507f1f77bcf86cd799439012",
  "userId": "507f1f77bcf86cd799439011",
  "sourceType": "video",
  "title": "AIå‘å±•è¶‹åŠ¿åˆ†æ",
  "originalUrl": "https://www.youtube.com/watch?v=xxxxx",
  "status": "completed",
  "video": {
    "platform": "youtube",
    "videoId": "xxxxx",
    "duration": 1800,
    "transcriptSource": "native"
  },
  "language": "zh",
  "wordCount": 5000,
  "createdAt": "2025-11-10T10:00:00.000Z",
  "updatedAt": "2025-11-10T10:05:00.000Z"
}
```

#### 3. segmentsï¼ˆæ–‡æœ¬ç‰‡æ®µé›†åˆï¼‰

```typescript
const segmentSchema = new mongoose.Schema({
  documentId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Document',
    required: true,
    index: true
  },
  segmentIndex: {
    type: Number,
    required: true
    // ç‰‡æ®µåºå·ï¼Œç”¨äºä¿æŒåŸæ–‡é¡ºåº
    // ä¾‹å¦‚ï¼šè§†é¢‘å­—å¹•æŒ‰æ—¶é—´é¡ºåºä¸º 0, 1, 2...
    // æŸ¥è¯¢æ—¶æŒ‰æ­¤å­—æ®µæ’åºå¯è¿˜åŸåŸå§‹é¡ºåº
  },
  text: {
    type: String,
    required: true
    // ç‰‡æ®µçš„æ–‡æœ¬å†…å®¹
    // è§†é¢‘ï¼šä¸€å¥å­—å¹•çš„æ–‡å­—
    // PDFï¼šä¸€æ®µæ–‡æœ¬
  },
  
  // è§†é¢‘æ—¶é—´æˆ³ï¼ˆä»…è§†é¢‘ç±»å‹ä½¿ç”¨ï¼‰
  startTime: Number,  // å¼€å§‹æ—¶é—´ï¼ˆç§’ï¼‰
  endTime: Number,    // ç»“æŸæ—¶é—´ï¼ˆç§’ï¼‰
  
  // PDFä½ç½®ï¼ˆä»…PDFç±»å‹ä½¿ç”¨ï¼‰
  pageNumber: Number,    // é¡µç 
  startOffset: Number,   // åœ¨é¡µé¢ä¸­çš„èµ·å§‹å­—ç¬¦åç§»
  endOffset: Number,     // åœ¨é¡µé¢ä¸­çš„ç»“æŸå­—ç¬¦åç§»
  
  // æ–‡æœ¬ä½ç½®ï¼ˆä»…çº¯æ–‡æœ¬ç±»å‹ä½¿ç”¨ï¼‰
  charStart: Number,  // åœ¨å…¨æ–‡ä¸­çš„èµ·å§‹å­—ç¬¦ä½ç½®
  charEnd: Number,    // åœ¨å…¨æ–‡ä¸­çš„ç»“æŸå­—ç¬¦ä½ç½®
  
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// å¤åˆç´¢å¼•ï¼šæŒ‰æ–‡æ¡£IDå’Œç‰‡æ®µé¡ºåºæŸ¥è¯¢
segmentSchema.index({ documentId: 1, segmentIndex: 1 });

// æ•°æ®ç¤ºä¾‹ï¼ˆè§†é¢‘å­—å¹•ç‰‡æ®µï¼‰
{
  "_id": "507f1f77bcf86cd799439013",
  "documentId": "507f1f77bcf86cd799439012",
  "segmentIndex": 0,  // ç¬¬1ä¸ªç‰‡æ®µ
  "text": "å¤§å®¶å¥½ï¼Œä»Šå¤©æˆ‘ä»¬æ¥èŠèŠAIçš„å‘å±•è¶‹åŠ¿...",
  "startTime": 0.0,
  "endTime": 5.2,
  "createdAt": "2025-11-10T10:05:00.000Z"
}

{
  "_id": "507f1f77bcf86cd799439014",
  "documentId": "507f1f77bcf86cd799439012",
  "segmentIndex": 1,  // ç¬¬2ä¸ªç‰‡æ®µ
  "text": "æœ€è¿‘ä¸€å¹´ï¼Œå¤§æ¨¡å‹æŠ€æœ¯å‘å±•è¿…é€Ÿ...",
  "startTime": 5.2,
  "endTime": 10.5,
  "createdAt": "2025-11-10T10:05:00.000Z"
}

// æŸ¥è¯¢æ—¶æŒ‰ segmentIndex æ’åºï¼Œå¯ä»¥æŒ‰åŸå§‹é¡ºåºå±•ç¤º
// ç¤ºä¾‹ä»£ç ï¼š
const segments = await Segment
  .find({ documentId: docId })
  .sort({ segmentIndex: 1 })  // æŒ‰åºå·å‡åºæ’åˆ—
  .exec();

// ç»“æœï¼š[ç‰‡æ®µ0, ç‰‡æ®µ1, ç‰‡æ®µ2, ...] æŒ‰åŸæ–‡é¡ºåºè¿”å›
```

#### 4. knowledge_pointsï¼ˆçŸ¥è¯†ç‚¹é›†åˆï¼‰

```typescript
const knowledgePointSchema = new mongoose.Schema({
  documentId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Document',
    required: true,
    index: true
    // å…³è”çš„æ–‡æ¡£ID
  },
  topic: {
    type: String,
    required: true
    // çŸ¥è¯†ç‚¹ä¸»é¢˜/æ ‡é¢˜
    // ä¾‹å¦‚ï¼š"AIä½œä¸ºåŠ³åŠ¨è€…"ã€"å¤§æ¨¡å‹çš„å‘å±•è¶‹åŠ¿"
  },
  excerpt: {
    type: String,
    required: true
    // çŸ¥è¯†ç‚¹æ‘˜å½•ï¼ˆåŸæ–‡æ‘˜å½•æˆ–è½»åº¦æ”¹å†™ï¼‰
    // é•¿åº¦æ§åˆ¶åœ¨50-150å­—
    // ä¾‹å¦‚ï¼š"AIä¸å†æ˜¯å·¥å…·ï¼Œè€Œæ˜¯ä¼šä½¿ç”¨å·¥å…·çš„'å·¥äºº'ã€‚"
  },
  confidenceScore: {
    type: Number,
    min: 0,
    max: 1
    // AIæç‚¼çš„ç½®ä¿¡åº¦åˆ†æ•°ï¼ˆ0-1ä¹‹é—´ï¼‰
    // ç”¨äºåˆ¤æ–­çŸ¥è¯†ç‚¹çš„é‡è¦æ€§å’Œå¯é æ€§
    // ä¾‹å¦‚ï¼š0.92 è¡¨ç¤º92%çš„ç½®ä¿¡åº¦
  },
  
  // æºé”šç‚¹ï¼ˆåµŒå¥—æ–‡æ¡£ï¼‰- è®°å½•çŸ¥è¯†ç‚¹åœ¨åŸæ–‡ä¸­çš„ä½ç½®
  sourceAnchor: {
    type: {
      type: String,
      enum: ['video', 'pdf', 'text'],
      required: true
      // æºç±»å‹ï¼šè§†é¢‘/PDF/çº¯æ–‡æœ¬
    },
    // è§†é¢‘ç±»å‹ä½¿ç”¨ï¼ˆç§’ï¼‰
    startTime: Number,  // åœ¨è§†é¢‘ä¸­çš„èµ·å§‹æ—¶é—´
    endTime: Number,    // åœ¨è§†é¢‘ä¸­çš„ç»“æŸæ—¶é—´
    
    // PDFç±»å‹ä½¿ç”¨
    page: Number,           // é¡µç 
    startOffset: Number,    // é¡µé¢ä¸­çš„èµ·å§‹å­—ç¬¦åç§»
    endOffset: Number,      // é¡µé¢ä¸­çš„ç»“æŸå­—ç¬¦åç§»
    
    // å…³è”çš„segment IDï¼ˆå¯é€‰ï¼‰
    segmentId: mongoose.Schema.Types.ObjectId
    // æŒ‡å‘å…·ä½“çš„segmentæ–‡æ¡£ï¼Œæ–¹ä¾¿å¿«é€Ÿå®šä½
  },
  
  displayOrder: Number,
  // å±•ç¤ºé¡ºåºï¼ˆå‰ç«¯æ’åºç”¨ï¼‰
  // æŒ‰é‡è¦æ€§æ’åºï¼š1, 2, 3...
  // AIç”Ÿæˆæ—¶ä¼šæŒ‰é‡è¦æ€§èµ‹å€¼
  
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// æ•°æ®ç¤ºä¾‹ï¼ˆè§†é¢‘çŸ¥è¯†ç‚¹ï¼‰
{
  "_id": "507f1f77bcf86cd799439014",
  "documentId": "507f1f77bcf86cd799439012",
  "topic": "AIä½œä¸ºåŠ³åŠ¨è€…",  // çŸ¥è¯†ç‚¹æ ‡é¢˜
  "excerpt": "AIä¸å†æ˜¯å·¥å…·ï¼Œè€Œæ˜¯ä¼šä½¿ç”¨å·¥å…·çš„'å·¥äºº'ã€‚",  // åŸæ–‡æ‘˜å½•
  "confidenceScore": 0.92,  // 92%ç½®ä¿¡åº¦
  "sourceAnchor": {
    "type": "video",
    "startTime": 123.5,  // è§†é¢‘2åˆ†3.5ç§’å¤„
    "endTime": 127.0,    // åˆ°2åˆ†7ç§’
    "segmentId": "507f1f77bcf86cd799439013"  // å…³è”çš„segment
  },
  "displayOrder": 1,  // ç¬¬1ä¸ªçŸ¥è¯†ç‚¹ï¼ˆæœ€é‡è¦ï¼‰
  "createdAt": "2025-11-10T10:06:00.000Z"
}

// å‰ç«¯ä½¿ç”¨ç¤ºä¾‹ï¼š
// 1. å±•ç¤ºçŸ¥è¯†ç‚¹åˆ—è¡¨
knowledgePoints.sort((a, b) => a.displayOrder - b.displayOrder);

// 2. ç‚¹å‡»è§’æ ‡è·³è½¬åˆ°åŸæ–‡
function jumpToSource(kp) {
  if (kp.sourceAnchor.type === 'video') {
    // è·³è½¬åˆ°è§†é¢‘æ—¶é—´ç‚¹
    videoPlayer.seekTo(kp.sourceAnchor.startTime);
    // é«˜äº®å¯¹åº”çš„segment
    highlightSegment(kp.sourceAnchor.segmentId);
  }
}

// 3. æ‚¬åœæ˜¾ç¤ºé¢„è§ˆ
function showPreview(kp) {
  // æ ¹æ® segmentId æŸ¥æ‰¾ä¸Šä¸‹æ–‡
  const segment = segments.find(s => s._id === kp.sourceAnchor.segmentId);
  const prevSegment = segments[segment.segmentIndex - 1];
  const nextSegment = segments[segment.segmentIndex + 1];
  // æ˜¾ç¤ºä¸Šä¸‹æ–‡
  return `...${prevSegment.text} ${segment.text} ${nextSegment.text}...`;
}
```

#### 5. insightsï¼ˆæ´å¯Ÿé›†åˆï¼‰

```typescript
const insightSchema = new mongoose.Schema({
  knowledgePointId: {
    type: mongoose.Schema.Types.ObjectId,
    ref: 'KnowledgePoint',
    required: true,
    index: true
    // å…³è”çš„çŸ¥è¯†ç‚¹ID
    // ä¸€ä¸ªçŸ¥è¯†ç‚¹åªæœ‰ä¸€ä¸ªæ´å¯Ÿï¼ˆä¸€å¯¹ä¸€å…³ç³»ï¼‰ï¼Œä½†å¯ä»¥é‡æ–°ç”Ÿæˆè¦†ç›–
  },
  
  // æ´å¯Ÿå†…å®¹ï¼ˆä¸‰æ®µå¼ç»“æ„ï¼‰
  logic: {
    type: String,
    required: true
    // é€»è¾‘æ¼”ç»ï¼šçŸ¥è¯†ç‚¹èƒŒåçš„é€»è¾‘æ˜¯ä»€ä¹ˆ
    // ä¾‹å¦‚ï¼š"è¿™ä¸ªè§‚ç‚¹åæ˜ äº†AIä»å·¥å…·åˆ°ä¸»ä½“çš„è§’è‰²è½¬å˜..."
  },
  hiddenInfo: String,
  // éšå«ä¿¡æ¯ï¼šçŸ¥è¯†ç‚¹æ²¡æœ‰ç›´æ¥è¯´æ˜çš„å†…å®¹
  // ä¾‹å¦‚ï¼š"è¿™æ„å‘³ç€æœªæ¥å·¥ä½œæ–¹å¼å¯èƒ½å‘ç”Ÿæ ¹æœ¬æ€§æ”¹å˜..."
  
  extensionOptional: String,
  // å»¶ä¼¸æ€è€ƒï¼šå¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢çš„æ–¹å‘
  // ä¾‹å¦‚ï¼š"å¯ä»¥å…³æ³¨AIä¼¦ç†ã€åŠ³åŠ¨æ³•ç­‰ç›¸å…³è®®é¢˜..."
  
  // ç»Ÿè®¡ç›¸å…³
  tokensUsed: Number,
  // LLMè°ƒç”¨æ¶ˆè€—çš„tokenæ•°
  // ç”¨äºæˆæœ¬ç»Ÿè®¡å’Œåˆ†æ
  
  generationTimeMs: Number,
  // ç”Ÿæˆè€—æ—¶ï¼ˆæ¯«ç§’ï¼‰
  // ç”¨äºæ€§èƒ½ç›‘æ§
  
  createdAt: {
    type: Date,
    default: Date.now
  }
});

// æ•°æ®ç¤ºä¾‹
{
  "_id": "507f1f77bcf86cd799439015",
  "knowledgePointId": "507f1f77bcf86cd799439014",  // å…³è”"AIä½œä¸ºåŠ³åŠ¨è€…"çŸ¥è¯†ç‚¹
  
  // ä¸‰æ®µå¼æ´å¯Ÿå†…å®¹
  "logic": "AIçš„æ ¸å¿ƒèƒ½åŠ›ä»çº¯æ‰§è¡Œå‘½ä»¤è½¬ä¸ºç†è§£æ„å›¾ä¸å·¥å…·è°ƒåº¦ï¼Œè¿™åæ˜ äº†AIä»å·¥å…·åˆ°ä¸»ä½“çš„è§’è‰²è½¬å˜...",
  "hiddenInfo": "è¿™æ ·çš„è¡¨è¿°æš—ç¤ºäº§ä¸šé“¾ä¸­é—´æ¨¡å—å¯èƒ½è¢«é‡æ„ï¼Œä¼ ç»Ÿçš„å·¥ä½œæµç¨‹å°†å‘ç”Ÿæ ¹æœ¬æ€§æ”¹å˜...",
  "extensionOptional": "å¯ä»¥è¿›ä¸€æ­¥å…³æ³¨AI Agentã€è‡ªä¸»AIç³»ç»Ÿç­‰æŠ€æœ¯æ–¹å‘ï¼Œä»¥åŠAIä¼¦ç†å’ŒåŠ³åŠ¨æ³•ç­‰ç›¸å…³è®®é¢˜...",
  
  "tokensUsed": 850,         // æ¶ˆè€—850ä¸ªtoken
  "generationTimeMs": 2300,  // ç”Ÿæˆè€—æ—¶2.3ç§’
  "createdAt": "2025-11-10T10:07:00.000Z"
}

// ä½¿ç”¨ç­–ç•¥ï¼š
// 1. æŒ‰éœ€ç”Ÿæˆï¼šç”¨æˆ·ç‚¹å‡»æŸä¸ªçŸ¥è¯†ç‚¹æ—¶ï¼Œæ‰ç”Ÿæˆæ´å¯Ÿ
// 2. å¦‚æœå·²ç”Ÿæˆï¼Œç›´æ¥è¿”å›ï¼›å¦‚æœæœªç”Ÿæˆï¼Œè°ƒç”¨LLMç”Ÿæˆ
// 3. æ”¯æŒé‡æ–°ç”Ÿæˆï¼šåˆ é™¤æ—§æ´å¯Ÿï¼Œç”Ÿæˆæ–°æ´å¯Ÿè¦†ç›–
async generateInsight(knowledgePointId: string, forceRegenerate: boolean = false) {
  // æ£€æŸ¥æ˜¯å¦å·²ç”Ÿæˆè¿‡
  const existingInsight = await Insight.findOne({ knowledgePointId });
  
  // å¦‚æœå·²å­˜åœ¨ä¸”ä¸å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼Œç›´æ¥è¿”å›
  if (existingInsight && !forceRegenerate) {
    return existingInsight;
  }
  
  // å¦‚æœå¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼Œåˆ é™¤æ—§æ´å¯Ÿ
  if (existingInsight && forceRegenerate) {
    await Insight.deleteOne({ knowledgePointId });
  }
  
  // è°ƒç”¨LLMç”Ÿæˆæ–°æ´å¯Ÿ
  const knowledgePoint = await KnowledgePoint.findById(knowledgePointId);
  const insight = await llmService.generateInsight(knowledgePoint);
  
  // ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆå¦‚æœå·²å­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™åˆ›å»ºï¼‰
  if (existingInsight && forceRegenerate) {
    // æ›´æ–°ç°æœ‰æ´å¯Ÿ
    existingInsight.logic = insight.logic;
    existingInsight.hiddenInfo = insight.hiddenInfo;
    existingInsight.extensionOptional = insight.extensionOptional;
    existingInsight.tokensUsed = insight.tokensUsed;
    existingInsight.generationTimeMs = insight.generationTimeMs;
    existingInsight.createdAt = new Date();
    return await existingInsight.save();
  } else {
    // åˆ›å»ºæ–°æ´å¯Ÿ
    return await Insight.create({
      knowledgePointId,
      logic: insight.logic,
      hiddenInfo: insight.hiddenInfo,
      extensionOptional: insight.extensionOptional,
      tokensUsed: insight.tokensUsed,
      generationTimeMs: insight.generationTimeMs
    });
  }
}

// 2. æˆæœ¬æ§åˆ¶
const totalTokens = await Insight.aggregate([
  { $group: { _id: null, total: { $sum: '$tokensUsed' } } }
]);
// ç›‘æ§æ€»æ¶ˆè€—ï¼Œä¼˜åŒ–prompt
```

#### 6. sms_verification_codesï¼ˆçŸ­ä¿¡éªŒè¯ç é›†åˆï¼‰

```typescript
const smsCodeSchema = new mongoose.Schema({
  phone: {
    type: String,
    required: true,
    index: true
    // æ‰‹æœºå·ï¼ˆä¸­å›½å¤§é™†11ä½ï¼‰
    // æ ¼å¼ï¼š13812345678
  },
  code: {
    type: String,
    required: true
    // 6ä½æ•°å­—éªŒè¯ç 
    // ç”Ÿæˆè§„åˆ™ï¼šMath.random() æˆ–éšæœºæ•°åº“
    // ä¾‹å¦‚ï¼š"123456"
  },
  expiresAt: {
    type: Date,
    required: true,
    index: true  // æ”¯æŒè‡ªåŠ¨è¿‡æœŸæ¸…ç†
    // è¿‡æœŸæ—¶é—´ï¼Œé€šå¸¸ä¸º5åˆ†é’Ÿå
    // ä¾‹å¦‚ï¼šnew Date(Date.now() + 5 * 60 * 1000)
  },
  used: {
    type: Boolean,
    default: false
    // æ˜¯å¦å·²ä½¿ç”¨
    // éªŒè¯æˆåŠŸåè®¾ä¸º trueï¼Œé˜²æ­¢é‡å¤ä½¿ç”¨
  },
  createdAt: {
    type: Date,
    default: Date.now
    // åˆ›å»ºæ—¶é—´
  }
});

// å¤åˆç´¢å¼•ï¼šæŸ¥è¯¢æœªä½¿ç”¨ä¸”æœªè¿‡æœŸçš„éªŒè¯ç 
smsCodeSchema.index({ phone: 1, expiresAt: 1, used: 1 });

// TTLç´¢å¼•ï¼šè‡ªåŠ¨åˆ é™¤è¿‡æœŸéªŒè¯ç ï¼ˆ24å°æ—¶åï¼‰
smsCodeSchema.index({ expiresAt: 1 }, { expireAfterSeconds: 86400 });

// æ•°æ®ç¤ºä¾‹
{
  "_id": "507f1f77bcf86cd799439016",
  "phone": "13800138000",              // æ‰‹æœºå·
  "code": "123456",                    // éªŒè¯ç 
  "expiresAt": "2025-11-10T10:10:00.000Z",  // 5åˆ†é’Ÿåè¿‡æœŸ
  "used": false,                       // æœªä½¿ç”¨
  "createdAt": "2025-11-10T10:05:00.000Z"   // åˆ›å»ºæ—¶é—´
}

// ä½¿ç”¨æµç¨‹ï¼š
// 1. å‘é€éªŒè¯ç 
async sendCode(phone: string) {
  // ç”Ÿæˆ6ä½éšæœºéªŒè¯ç 
  const code = Math.floor(100000 + Math.random() * 900000).toString();
  
  // ä¿å­˜åˆ°æ•°æ®åº“ï¼ˆ5åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰
  await SmsCode.create({
    phone,
    code,
    expiresAt: new Date(Date.now() + 5 * 60 * 1000),
    used: false
  });
  
  // è°ƒç”¨é˜¿é‡Œäº‘çŸ­ä¿¡APIå‘é€
  await aliyunSms.send(phone, code);
}

// 2. éªŒè¯éªŒè¯ç 
async verifyCode(phone: string, inputCode: string) {
  const smsCode = await SmsCode.findOne({
    phone,
    code: inputCode,
    used: false,
    expiresAt: { $gt: new Date() }  // æœªè¿‡æœŸ
  });
  
  if (!smsCode) {
    throw new Error('éªŒè¯ç æ— æ•ˆæˆ–å·²è¿‡æœŸ');
  }
  
  // æ ‡è®°ä¸ºå·²ä½¿ç”¨
  smsCode.used = true;
  await smsCode.save();
  
  return true;
}

// 3. MongoDBè‡ªåŠ¨æ¸…ç†
// TTLç´¢å¼•ä¼šåœ¨è¿‡æœŸ24å°æ—¶åè‡ªåŠ¨åˆ é™¤æ–‡æ¡£
// æ— éœ€æ‰‹åŠ¨æ¸…ç†
```

### MongoDB ç´¢å¼•ç­–ç•¥

```javascript
// users
db.users.createIndex({ phone: 1 }, { unique: true });

// documents
db.documents.createIndex({ userId: 1, createdAt: -1 });
db.documents.createIndex({ status: 1 });

// segments
db.segments.createIndex({ documentId: 1, segmentIndex: 1 });

// knowledge_points
db.knowledge_points.createIndex({ documentId: 1 });

// insights
db.insights.createIndex({ knowledgePointId: 1 }, { unique: true });  // ä¸€ä¸ªçŸ¥è¯†ç‚¹åªæœ‰ä¸€ä¸ªæ´å¯Ÿ

// sms_verification_codes
db.sms_verification_codes.createIndex({ phone: 1, expiresAt: 1, used: 1 });
db.sms_verification_codes.createIndex({ expiresAt: 1 }, { expireAfterSeconds: 86400 });
```

### é¡¹ç›®æ–‡ä»¶ç»“æ„

#### æ•´ä½“ç»“æ„

```
knowlens/                                   # é¡¹ç›®æ ¹ç›®å½•
â”œâ”€â”€ frontend/                               # å‰ç«¯é¡¹ç›®
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ vite.config.ts
â”‚   â”œâ”€â”€ index.html
â”‚   â””â”€â”€ src/
â”‚
â””â”€â”€ backend/                                # åç«¯é¡¹ç›®
    â”œâ”€â”€ package.json
    â”œâ”€â”€ tsconfig.json
    â”œâ”€â”€ nest-cli.json
    â””â”€â”€ src/
```

#### å‰ç«¯é¡¹ç›®ç»“æ„ï¼ˆfrontend/ï¼‰

```
frontend/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â”œâ”€â”€ .env.development                        # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production                         # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ index.html
â”‚
â”œâ”€â”€ public/                                 # é™æ€èµ„æº
â”‚   â”œâ”€â”€ favicon.ico
â”‚   â””â”€â”€ logo.png
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ main.tsx                           # åº”ç”¨å…¥å£
    â”œâ”€â”€ App.tsx                            # æ ¹ç»„ä»¶
    â”‚
    â”œâ”€â”€ pages/                             # é¡µé¢ç»„ä»¶
    â”‚   â”œâ”€â”€ Home/                          # é¦–é¡µï¼ˆè¾“å…¥è§†é¢‘/PDFï¼‰
    â”‚   â”‚   â”œâ”€â”€ index.tsx
    â”‚   â”‚   â””â”€â”€ index.module.css
    â”‚   â”œâ”€â”€ Document/                      # æ–‡æ¡£è¯¦æƒ…é¡µ
    â”‚   â”‚   â”œâ”€â”€ VideoDocument.tsx          # è§†é¢‘ç»“æœé¡µ
    â”‚   â”‚   â”œâ”€â”€ PdfDocument.tsx            # PDFç»“æœé¡µ
    â”‚   â”‚   â”œâ”€â”€ TextDocument.tsx           # æ–‡æœ¬ç»“æœé¡µ
    â”‚   â”‚   â””â”€â”€ components/                # æ–‡æ¡£é¡µä¸“ç”¨ç»„ä»¶
    â”‚   â”‚       â”œâ”€â”€ KnowledgeCard.tsx      # çŸ¥è¯†ç‚¹å¡ç‰‡
    â”‚   â”‚       â””â”€â”€ InsightCard.tsx        # æ´å¯Ÿå¡ç‰‡
    â”‚   â””â”€â”€ Records/                       # è®°å½•åˆ—è¡¨é¡µ
    â”‚       â””â”€â”€ index.tsx
    â”‚
    â”œâ”€â”€ components/                        # é€šç”¨ç»„ä»¶
    â”‚   â”œâ”€â”€ Layout/                        # å¸ƒå±€ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ Header.tsx
    â”‚   â”‚   â””â”€â”€ Sidebar.tsx
    â”‚   â”œâ”€â”€ LoginModal/                    # ç™»å½•å¼¹çª—ï¼ˆå…¨å±€ï¼‰
    â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚   â”œâ”€â”€ VideoPlayer/                   # è§†é¢‘æ’­æ”¾å™¨
    â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚   â”œâ”€â”€ PdfViewer/                     # PDFæŸ¥çœ‹å™¨
    â”‚   â”‚   â””â”€â”€ index.tsx
    â”‚   â””â”€â”€ Loading/                       # åŠ è½½ç»„ä»¶
    â”‚       â””â”€â”€ index.tsx
    â”‚
    â”œâ”€â”€ stores/                            # zustand çŠ¶æ€ç®¡ç†
    â”‚   â”œâ”€â”€ authStore.ts                   # è®¤è¯çŠ¶æ€
    â”‚   â”œâ”€â”€ documentStore.ts               # æ–‡æ¡£çŠ¶æ€
    â”‚   â””â”€â”€ uiStore.ts                     # UIçŠ¶æ€ï¼ˆå¦‚å¼¹çª—æ˜¾ç¤ºï¼‰
    â”‚
    â”œâ”€â”€ api/                               # API è¯·æ±‚å°è£…ï¼ˆåŒ…å«ç±»å‹å®šä¹‰ï¼‰
    â”‚   â”œâ”€â”€ request.ts                     # Axios é…ç½®
    â”‚   â”œâ”€â”€ auth.ts                        # è®¤è¯ç›¸å…³ API + ç±»å‹
    â”‚   â”œâ”€â”€ document.ts                    # æ–‡æ¡£ç›¸å…³ API + ç±»å‹
    â”‚   â””â”€â”€ insight.ts                     # æ´å¯Ÿç›¸å…³ API + ç±»å‹
    â”‚
    â”œâ”€â”€ utils/                             # å·¥å…·å‡½æ•°
    â”‚   â”œâ”€â”€ constants.ts                   # å¸¸é‡
    â”‚   â”œâ”€â”€ validators.ts                  # éªŒè¯å‡½æ•°
    â”‚   â””â”€â”€ helpers.ts                     # è¾…åŠ©å‡½æ•°
    â”‚
    â”œâ”€â”€ hooks/                             # è‡ªå®šä¹‰ Hooks
    â”‚   â”œâ”€â”€ useAuth.ts
    â”‚   â”œâ”€â”€ useDocument.ts
    â”‚   â””â”€â”€ usePolling.ts                  # è½®è¯¢ Hook
    â”‚
    â”œâ”€â”€ assets/                            # èµ„æºæ–‡ä»¶
    â”‚   â”œâ”€â”€ images/
    â”‚   â””â”€â”€ styles/
    â”‚       â””â”€â”€ global.css
    â”‚
    â””â”€â”€ router/                            # è·¯ç”±é…ç½®
        â””â”€â”€ index.tsx
```

#### åç«¯é¡¹ç›®ç»“æ„ï¼ˆbackend/ï¼‰

```
backend/
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ nest-cli.json
â”œâ”€â”€ .env.development                        # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production                         # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”‚
â””â”€â”€ src/
    â”œâ”€â”€ main.ts                            # åº”ç”¨å…¥å£
    â”‚
    â”œâ”€â”€ app.module.ts                      # æ ¹æ¨¡å—
    â”‚
    â”œâ”€â”€ modules/                           # åŠŸèƒ½æ¨¡å—
    â”‚   â”‚
    â”‚   â”œâ”€â”€ auth/                          # è®¤è¯æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ auth.module.ts
    â”‚   â”‚   â”œâ”€â”€ auth.controller.ts
    â”‚   â”‚   â”œâ”€â”€ auth.service.ts
    â”‚   â”‚   â”œâ”€â”€ dto/
    â”‚   â”‚   â”‚   â”œâ”€â”€ send-code.dto.ts
    â”‚   â”‚   â”‚   â””â”€â”€ verify-code.dto.ts
    â”‚   â”‚   â”œâ”€â”€ guards/
    â”‚   â”‚   â”‚   â””â”€â”€ jwt-auth.guard.ts
    â”‚   â”‚   â””â”€â”€ strategies/
    â”‚   â”‚       â””â”€â”€ jwt.strategy.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ user/                          # ç”¨æˆ·æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ user.module.ts
    â”‚   â”‚   â”œâ”€â”€ user.controller.ts
    â”‚   â”‚   â”œâ”€â”€ user.service.ts
    â”‚   â”‚   â”œâ”€â”€ schemas/
    â”‚   â”‚   â”‚   â””â”€â”€ user.schema.ts
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â””â”€â”€ update-user.dto.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ document/                      # æ–‡æ¡£æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ document.module.ts
    â”‚   â”‚   â”œâ”€â”€ document.controller.ts
    â”‚   â”‚   â”œâ”€â”€ document.service.ts
    â”‚   â”‚   â”œâ”€â”€ schemas/
    â”‚   â”‚   â”‚   â”œâ”€â”€ document.schema.ts
    â”‚   â”‚   â”‚   â””â”€â”€ segment.schema.ts
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â”œâ”€â”€ create-document.dto.ts
    â”‚   â”‚       â””â”€â”€ query-document.dto.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ video/                         # è§†é¢‘å¤„ç†æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ video.module.ts
    â”‚   â”‚   â”œâ”€â”€ video.controller.ts
    â”‚   â”‚   â”œâ”€â”€ video.service.ts
    â”‚   â”‚   â”œâ”€â”€ processors/                # BullMQ Processors
    â”‚   â”‚   â”‚   â””â”€â”€ video.processor.ts
    â”‚   â”‚   â”œâ”€â”€ services/
    â”‚   â”‚   â”‚   â”œâ”€â”€ youtube.service.ts     # YouTube å­—å¹•è·å–
    â”‚   â”‚   â”‚   â”œâ”€â”€ bilibili.service.ts    # Bç«™å­—å¹•è·å–
    â”‚   â”‚   â”‚   â””â”€â”€ xfyun.service.ts       # ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â””â”€â”€ submit-video.dto.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ pdf/                           # PDFå¤„ç†æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ pdf.module.ts
    â”‚   â”‚   â”œâ”€â”€ pdf.controller.ts
    â”‚   â”‚   â”œâ”€â”€ pdf.service.ts
    â”‚   â”‚   â”œâ”€â”€ processors/
    â”‚   â”‚   â”‚   â””â”€â”€ pdf.processor.ts
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â””â”€â”€ upload-pdf.dto.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ knowledge/                     # çŸ¥è¯†ç‚¹æ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ knowledge.module.ts
    â”‚   â”‚   â”œâ”€â”€ knowledge.controller.ts
    â”‚   â”‚   â”œâ”€â”€ knowledge.service.ts
    â”‚   â”‚   â”œâ”€â”€ schemas/
    â”‚   â”‚   â”‚   â””â”€â”€ knowledge-point.schema.ts
    â”‚   â”‚   â”œâ”€â”€ processors/
    â”‚   â”‚   â”‚   â””â”€â”€ knowledge.processor.ts
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â””â”€â”€ create-knowledge.dto.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ insight/                       # æ´å¯Ÿæ¨¡å—
    â”‚   â”‚   â”œâ”€â”€ insight.module.ts
    â”‚   â”‚   â”œâ”€â”€ insight.controller.ts
    â”‚   â”‚   â”œâ”€â”€ insight.service.ts
    â”‚   â”‚   â”œâ”€â”€ schemas/
    â”‚   â”‚   â”‚   â””â”€â”€ insight.schema.ts
    â”‚   â”‚   â””â”€â”€ dto/
    â”‚   â”‚       â””â”€â”€ generate-insight.dto.ts
    â”‚   â”‚
    â”‚   â””â”€â”€ aliyun/                        # é˜¿é‡Œäº‘æœåŠ¡æ¨¡å—
    â”‚       â”œâ”€â”€ aliyun.module.ts
    â”‚       â”œâ”€â”€ oss.service.ts             # OSS æœåŠ¡
    â”‚       â””â”€â”€ sms.service.ts             # çŸ­ä¿¡æœåŠ¡
    â”‚
    â”œâ”€â”€ common/                            # é€šç”¨æ¨¡å—
    â”‚   â”œâ”€â”€ decorators/                    # è£…é¥°å™¨
    â”‚   â”‚   â”œâ”€â”€ user.decorator.ts
    â”‚   â”‚   â””â”€â”€ roles.decorator.ts
    â”‚   â”œâ”€â”€ filters/                       # å¼‚å¸¸è¿‡æ»¤å™¨
    â”‚   â”‚   â””â”€â”€ http-exception.filter.ts
    â”‚   â”œâ”€â”€ guards/                        # å®ˆå«
    â”‚   â”‚   â””â”€â”€ roles.guard.ts
    â”‚   â”œâ”€â”€ interceptors/                  # æ‹¦æˆªå™¨
    â”‚   â”‚   â”œâ”€â”€ transform.interceptor.ts
    â”‚   â”‚   â””â”€â”€ logging.interceptor.ts
    â”‚   â”œâ”€â”€ pipes/                         # ç®¡é“
    â”‚   â”‚   â””â”€â”€ validation.pipe.ts
    â”‚   â””â”€â”€ middleware/                    # ä¸­é—´ä»¶
    â”‚       â””â”€â”€ logger.middleware.ts
    â”‚
    â”œâ”€â”€ config/                            # é…ç½®æ–‡ä»¶
    â”‚   â”œâ”€â”€ configuration.ts               # ä¸»é…ç½®
    â”‚   â”œâ”€â”€ database.config.ts             # æ•°æ®åº“é…ç½®
    â”‚   â””â”€â”€ redis.config.ts                # Redis é…ç½®
    â”‚
    â”œâ”€â”€ shared/                            # å…±äº«æ¨¡å—
    â”‚   â”œâ”€â”€ services/
    â”‚   â”‚   â”œâ”€â”€ moonshot.service.ts        # Moonshot AI æœåŠ¡
    â”‚   â”‚   â””â”€â”€ cache.service.ts           # ç¼“å­˜æœåŠ¡ï¼ˆMVPé˜¶æ®µæš‚ä¸ä½¿ç”¨ï¼Œåç»­ä¼˜åŒ–é¢„ç•™ï¼‰
    â”‚   â””â”€â”€ interfaces/                    # å…±äº«æ¥å£
    â”‚       â””â”€â”€ common.interface.ts
    â”‚
    â””â”€â”€ utils/                             # å·¥å…·å‡½æ•°
        â”œâ”€â”€ constants.ts
        â””â”€â”€ helpers.ts
```

---

## ğŸ” è®¤è¯æ–¹æ¡ˆè¯´æ˜

#### è®¤è¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    1. ç”¨æˆ·ç™»å½•                           â”‚
â”‚  å‰ç«¯: æäº¤æ‰‹æœºå· + éªŒè¯ç                                 â”‚
â”‚  åç«¯: éªŒè¯æˆåŠŸ â†’ ç”Ÿæˆ JWT â†’ è®¾ç½® Cookie                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 2. åç»­è¯·æ±‚è‡ªåŠ¨æºå¸¦ Cookie                â”‚
â”‚  å‰ç«¯: withCredentials: true                             â”‚
â”‚  æµè§ˆå™¨: è‡ªåŠ¨é™„åŠ  Cookie (token)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 3. åç«¯éªŒè¯ Token                         â”‚
â”‚  ä» request.cookies è¯»å– token                           â”‚
â”‚  JwtService éªŒè¯ â†’ è§£æç”¨æˆ·ä¿¡æ¯                          â”‚
â”‚  é™„åŠ åˆ° request.user                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 4. Token å¤±æ•ˆå¤„ç†                         â”‚
â”‚  åç«¯: è¿”å› 401 Unauthorized                             â”‚
â”‚  å‰ç«¯: æ‹¦æˆªå™¨è‡ªåŠ¨æ‰“å¼€ç™»å½•å¼¹çª—                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å…³é”®é…ç½®ç‚¹

**å‰ç«¯ï¼ˆ`request.ts`ï¼‰**ï¼š
```typescript
const request = axios.create({
  withCredentials: true,  // âœ… å…è®¸æºå¸¦ cookie
});
```

**åç«¯ï¼ˆ`main.ts`ï¼‰**ï¼š
```typescript
app.enableCors({
  origin: 'http://localhost:5173',
  credentials: true,  // âœ… å…è®¸æ¥æ”¶ cookie
});

app.use(cookieParser());  // âœ… è§£æ cookie
```

**åç«¯ï¼ˆç™»å½•æ¥å£ï¼‰**ï¼š
```typescript
response.cookie('token', token, {
  httpOnly: true,   // âœ… é˜² XSS
  secure: true,     // âœ… ä»… HTTPS
  sameSite: 'lax',  // âœ… é˜² CSRF
  maxAge: 7 * 24 * 60 * 60 * 1000,  // 7å¤©
});
```

**åç«¯ï¼ˆè®¤è¯å®ˆå«ï¼‰**ï¼š
```typescript
const token = request.cookies?.token;  // âœ… ä» cookie è¯»å–
```

---

### å…³é”®ä»£ç ç¤ºä¾‹

#### å‰ç«¯ - API è¯·æ±‚å°è£…ï¼ˆ`frontend/src/api/request.ts`ï¼‰

```typescript
import axios from 'axios';
import { message } from 'antd';
import { useUIStore } from '@/stores/uiStore';

const request = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL || 'http://localhost:3000/api',
  timeout: 30000,
  withCredentials: true,  // é‡è¦ï¼šå…è®¸æºå¸¦ cookie
});

// è¯·æ±‚æ‹¦æˆªå™¨
request.interceptors.request.use(
  (config) => {
    // Cookie ä¼šè‡ªåŠ¨æºå¸¦ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½® Authorization header
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

// å“åº”æ‹¦æˆªå™¨
request.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    if (error.response?.status === 401) {
      // ç™»å½•å¤±æ•ˆï¼Œæ‰“å¼€ç™»å½•å¼¹çª—
      const { openLoginModal } = useUIStore.getState();
      openLoginModal();
      message.warning('ç™»å½•å·²å¤±æ•ˆï¼Œè¯·é‡æ–°ç™»å½•');
    } else {
      message.error(error.response?.data?.message || 'è¯·æ±‚å¤±è´¥');
    }
    return Promise.reject(error);
  }
);

export default request;
```

#### å‰ç«¯ - zustand è®¤è¯çŠ¶æ€ï¼ˆ`frontend/src/stores/authStore.ts`ï¼‰

```typescript
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface User {
  id: string;
  phone: string;
  nickname?: string;
  avatarUrl?: string;
}

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  
  // Actions
  login: (user: User) => void;
  logout: () => void;
  updateUser: (user: Partial<User>) => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      isAuthenticated: false,
      
      login: (user) => {
        // Token å­˜å‚¨åœ¨ cookie ä¸­ï¼Œç”±æµè§ˆå™¨è‡ªåŠ¨ç®¡ç†
        // è¿™é‡Œåªä¿å­˜ç”¨æˆ·ä¿¡æ¯
        set({ user, isAuthenticated: true });
      },
      
      logout: () => {
        // è°ƒç”¨åç«¯ logout æ¥å£æ¸…é™¤ cookie
        // è¿™é‡Œåªæ¸…é™¤æœ¬åœ°ç”¨æˆ·ä¿¡æ¯
        set({ user: null, isAuthenticated: false });
      },
      
      updateUser: (userData) => {
        set((state) => ({
          user: state.user ? { ...state.user, ...userData } : null
        }));
      }
    }),
    {
      name: 'auth-storage',
      partialize: (state) => ({ 
        user: state.user,
        isAuthenticated: state.isAuthenticated 
      })
    }
  )
);
```

#### å‰ç«¯ - API è¯·æ±‚ç¤ºä¾‹ï¼ˆ`frontend/src/api/auth.ts`ï¼‰

```typescript
import request from './request';

// ==================== ç±»å‹å®šä¹‰ ====================

export interface User {
  id: string;
  phone: string;
  nickname?: string;
  avatarUrl?: string;
}

export interface LoginResponse {
  success: boolean;
  user: User;
}

export interface SendSmsCodeResponse {
  success: boolean;
  message: string;
}

// ==================== API è¯·æ±‚ ====================

/**
 * å‘é€çŸ­ä¿¡éªŒè¯ç 
 */
export const sendSmsCode = async (phone: string): Promise<SendSmsCodeResponse> => {
  return request.post('/auth/send-code', { phone });
};

/**
 * éªŒè¯ç ç™»å½•
 */
export const verifyCode = async (phone: string, code: string): Promise<LoginResponse> => {
  return request.post('/auth/verify', { phone, code });
};

/**
 * é€€å‡ºç™»å½•
 */
export const logout = async (): Promise<{ success: boolean; message: string }> => {
  return request.post('/auth/logout');
};
```

#### å‰ç«¯ - zustand UIçŠ¶æ€ï¼ˆ`frontend/src/stores/uiStore.ts`ï¼‰

```typescript
import { create } from 'zustand';

interface UIState {
  isLoginModalOpen: boolean;
  isLoading: boolean;
  
  // Actions
  openLoginModal: () => void;
  closeLoginModal: () => void;
  setLoading: (loading: boolean) => void;
}

export const useUIStore = create<UIState>((set) => ({
  isLoginModalOpen: false,
  isLoading: false,
  
  openLoginModal: () => set({ isLoginModalOpen: true }),
  closeLoginModal: () => set({ isLoginModalOpen: false }),
  setLoading: (loading: boolean) => set({ isLoading: loading })
}));
```

#### å‰ç«¯ - ç™»å½•å¼¹çª—ç»„ä»¶ï¼ˆ`frontend/src/components/LoginModal/index.tsx`ï¼‰

```typescript
import { Modal, Form, Input, Button, message } from 'antd';
import { useState } from 'react';
import { useUIStore } from '@/stores/uiStore';
import { useAuthStore } from '@/stores/authStore';
import { sendSmsCode, verifyCode } from '@/api/auth';

export default function LoginModal() {
  const [form] = Form.useForm();
  const [countdown, setCountdown] = useState(0);
  const [loading, setLoading] = useState(false);
  
  const { isLoginModalOpen, closeLoginModal } = useUIStore();
  const { login } = useAuthStore();
  
  // å‘é€éªŒè¯ç 
  const handleSendCode = async () => {
    const phone = form.getFieldValue('phone');
    if (!phone || !/^1\d{10}$/.test(phone)) {
      message.error('è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·');
      return;
    }
    
    try {
      await sendSmsCode(phone);
      message.success('éªŒè¯ç å·²å‘é€');
      
      // å€’è®¡æ—¶
      let count = 60;
      setCountdown(count);
      const timer = setInterval(() => {
        count--;
        setCountdown(count);
        if (count === 0) clearInterval(timer);
      }, 1000);
    } catch (error) {
      message.error('å‘é€å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
  };
  
  // æäº¤ç™»å½•
  const handleSubmit = async (values: any) => {
    setLoading(true);
    try {
      // åç«¯éªŒè¯æˆåŠŸåä¼šè‡ªåŠ¨è®¾ç½® cookie
      const { user } = await verifyCode(values.phone, values.code);
      login(user);  // åªä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œtoken åœ¨ cookie ä¸­
      message.success('ç™»å½•æˆåŠŸ');
      closeLoginModal();
      form.resetFields();
    } catch (error) {
      message.error('éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ');
    } finally {
      setLoading(false);
    }
  };
  
  return (
    <Modal
      title="æ‰‹æœºå·ç™»å½•"
      open={isLoginModalOpen}
      onCancel={closeLoginModal}
      footer={null}
      width={400}
    >
      <Form form={form} onFinish={handleSubmit} layout="vertical">
        <Form.Item
          name="phone"
          label="æ‰‹æœºå·"
          rules={[
            { required: true, message: 'è¯·è¾“å…¥æ‰‹æœºå·' },
            { pattern: /^1\d{10}$/, message: 'è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·' }
          ]}
        >
          <Input placeholder="è¯·è¾“å…¥æ‰‹æœºå·" size="large" />
        </Form.Item>
        
        <Form.Item
          name="code"
          label="éªŒè¯ç "
          rules={[{ required: true, message: 'è¯·è¾“å…¥éªŒè¯ç ' }]}
        >
          <Input
            placeholder="è¯·è¾“å…¥éªŒè¯ç "
            size="large"
            addonAfter={
              <Button
                type="link"
                onClick={handleSendCode}
                disabled={countdown > 0}
                style={{ padding: 0 }}
              >
                {countdown > 0 ? `${countdown}ç§’åé‡è¯•` : 'è·å–éªŒè¯ç '}
              </Button>
            }
          />
        </Form.Item>
        
        <Form.Item>
          <Button
            type="primary"
            htmlType="submit"
            loading={loading}
            size="large"
            block
          >
            ç™»å½•
          </Button>
        </Form.Item>
      </Form>
    </Modal>
  );
}
```

#### åç«¯ - ç™»å½•æ¥å£ï¼ˆ`backend/src/modules/auth/auth.controller.ts`ï¼‰

```typescript
import { Controller, Post, Body, Res } from '@nestjs/common';
import { Response } from 'express';
import { ApiTags, ApiOperation } from '@nestjs/swagger';
import { AuthService } from './auth.service';
import { VerifyCodeDto } from './dto/verify-code.dto';

@ApiTags('è®¤è¯')
@Controller('auth')
export class AuthController {
  constructor(private readonly authService: AuthService) {}

  @Post('verify')
  @ApiOperation({ summary: 'éªŒè¯ç ç™»å½•' })
  async verifyCode(
    @Body() dto: VerifyCodeDto,
    @Res({ passthrough: true }) response: Response
  ) {
    // éªŒè¯éªŒè¯ç å¹¶è·å–ç”¨æˆ·ä¿¡æ¯
    const { user, token } = await this.authService.verifyCode(dto.phone, dto.code);
    
    // å°† token è®¾ç½®åˆ° cookie ä¸­
    response.cookie('token', token, {
      httpOnly: true,      // é˜²æ­¢ XSS æ”»å‡»
      secure: process.env.NODE_ENV === 'production',  // ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ HTTPS
      sameSite: 'lax',     // CSRF é˜²æŠ¤
      maxAge: 7 * 24 * 60 * 60 * 1000,  // 7å¤©è¿‡æœŸ
      path: '/',
    });
    
    // è¿”å›ç”¨æˆ·ä¿¡æ¯ï¼ˆä¸è¿”å› tokenï¼‰
    return {
      success: true,
      user: {
        id: user._id,
        phone: user.phone,
        nickname: user.nickname,
        avatarUrl: user.avatarUrl,
      }
    };
  }
  
  @Post('logout')
  @ApiOperation({ summary: 'é€€å‡ºç™»å½•' })
  async logout(@Res({ passthrough: true }) response: Response) {
    // æ¸…é™¤ cookie
    response.clearCookie('token', { path: '/' });
    
    return {
      success: true,
      message: 'é€€å‡ºç™»å½•æˆåŠŸ'
    };
  }
}
```

#### åç«¯ - JWT è®¤è¯å®ˆå«ï¼ˆ`backend/src/common/guards/jwt-auth.guard.ts`ï¼‰

```typescript
import { Injectable, CanActivate, ExecutionContext, UnauthorizedException } from '@nestjs/common';
import { JwtService } from '@nestjs/jwt';
import { Request } from 'express';

@Injectable()
export class JwtAuthGuard implements CanActivate {
  constructor(private jwtService: JwtService) {}

  async canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest<Request>();
    
    // ä» cookie ä¸­è·å– token
    const token = request.cookies?.token;
    
    if (!token) {
      throw new UnauthorizedException('æœªç™»å½•');
    }

    try {
      // éªŒè¯ token
      const payload = await this.jwtService.verifyAsync(token, {
        secret: process.env.JWT_SECRET,
      });
      
      // å°†ç”¨æˆ·ä¿¡æ¯é™„åŠ åˆ° request å¯¹è±¡
      request['user'] = payload;
      
      return true;
    } catch (error) {
      throw new UnauthorizedException('ç™»å½•å·²å¤±æ•ˆ');
    }
  }
}
```

#### åç«¯ - CORS é…ç½®ï¼ˆ`backend/src/main.ts`ï¼‰

```typescript
import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import * as cookieParser from 'cookie-parser';

async function bootstrap() {
  const app = await NestFactory.create(AppModule);
  
  // ä½¿ç”¨ cookie-parser ä¸­é—´ä»¶
  app.use(cookieParser());
  
  // é…ç½® CORSï¼Œå…è®¸æºå¸¦ cookie
  app.enableCors({
    origin: process.env.CORS_ORIGIN || 'http://localhost:5173',  // å‰ç«¯åœ°å€
    credentials: true,  // é‡è¦ï¼šå…è®¸æºå¸¦ cookie
    methods: ['GET', 'POST', 'PUT', 'DELETE', 'PATCH', 'OPTIONS'],
    allowedHeaders: ['Content-Type', 'Accept'],
  });
  
  // å…¨å±€å‰ç¼€
  app.setGlobalPrefix('api');
  
  await app.listen(3000);
  console.log(`åº”ç”¨è¿è¡Œåœ¨: http://localhost:3000`);
}

bootstrap();
```

#### åç«¯ - è§†é¢‘æäº¤æ¥å£ï¼ˆ`backend/src/modules/video/video.controller.ts`ï¼‰

```typescript
import { Controller, Post, Body, UseGuards } from '@nestjs/common';
import { ApiTags, ApiOperation, ApiBearerAuth } from '@nestjs/swagger';
import { JwtAuthGuard } from '../auth/guards/jwt-auth.guard';
import { User } from '@/common/decorators/user.decorator';
import { VideoService } from './video.service';
import { SubmitVideoDto } from './dto/submit-video.dto';

@ApiTags('è§†é¢‘å¤„ç†')
@Controller('video')
export class VideoController {
  constructor(private readonly videoService: VideoService) {}

  @Post('submit')
  @UseGuards(JwtAuthGuard)
  @ApiBearerAuth()
  @ApiOperation({ summary: 'æäº¤è§†é¢‘é“¾æ¥' })
  async submitVideo(
    @Body() dto: SubmitVideoDto,
    @User('id') userId: string
  ) {
    return await this.videoService.submitVideo(dto, userId);
  }
}
```

#### åç«¯ - è§†é¢‘æœåŠ¡ï¼ˆ`backend/src/modules/video/video.service.ts`ï¼‰

```typescript
import { Injectable } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { InjectQueue } from '@nestjs/bullmq';
import { Model } from 'mongoose';
import { Queue } from 'bullmq';
import { Document } from '../document/schemas/document.schema';
import { SubmitVideoDto } from './dto/submit-video.dto';

@Injectable()
export class VideoService {
  constructor(
    @InjectModel(Document.name) 
    private documentModel: Model<Document>,
    
    @InjectQueue('video-queue') 
    private videoQueue: Queue
  ) {}

  async submitVideo(dto: SubmitVideoDto, userId: string) {
    // åˆ›å»ºæ–‡æ¡£è®°å½•
    const document = await this.documentModel.create({
      userId,
      sourceType: 'video',
      originalUrl: dto.videoUrl,
      status: 'processing',
    });

    // æŠ•é€’åˆ°ä»»åŠ¡é˜Ÿåˆ—
    await this.videoQueue.add('process-video', {
      documentId: document._id.toString(),
      videoUrl: dto.videoUrl,
      userId,
    }, {
      attempts: 3,
      backoff: {
        type: 'exponential',
        delay: 1000,
      }
    });

    return {
      documentId: document._id,
      status: 'processing',
      message: 'è§†é¢‘å¤„ç†ä»»åŠ¡å·²æäº¤'
    };
  }
}
```

#### åç«¯ - Worker å¤„ç†å™¨ï¼ˆ`backend/src/modules/video/processors/video.processor.ts`ï¼‰

```typescript
import { Processor, WorkerHost } from '@nestjs/bullmq';
import { Job } from 'bullmq';
import { Logger } from '@nestjs/common';
import { InjectModel } from '@nestjs/mongoose';
import { Model } from 'mongoose';
import { Document } from '../../document/schemas/document.schema';
import { Segment } from '../../document/schemas/segment.schema';
import { YoutubeService } from '../services/youtube.service';
import { BilibiliService } from '../services/bilibili.service';
import { XfyunService } from '../services/xfyun.service';
import { MoonshotService } from '../../../shared/services/moonshot.service';

@Processor('video-queue')
export class VideoProcessor extends WorkerHost {
  private readonly logger = new Logger(VideoProcessor.name);

  constructor(
    @InjectModel(Document.name) 
    private documentModel: Model<Document>,
    @InjectModel(Segment.name) 
    private segmentModel: Model<Segment>,
    private youtubeService: YoutubeService,
    private bilibiliService: BilibiliService,
    private xfyunService: XfyunService,
    private llmService: MoonshotService,
  ) {
    super();
  }

  async process(job: Job) {
    const { documentId, videoUrl, userId } = job.data;
    
    this.logger.log(`å¼€å§‹å¤„ç†è§†é¢‘ä»»åŠ¡: ${job.id}, æ–‡æ¡£: ${documentId}`);
    
    try {
      // æ›´æ–°è¿›åº¦
      await job.updateProgress(10);
      
      // è§£æè§†é¢‘å¹³å°
      const platform = this.parseVideoPlatform(videoUrl);
      
      // è·å–å­—å¹•
      let transcript;
      let transcriptSource = 'native';
      
      if (platform === 'youtube') {
        transcript = await this.youtubeService.getTranscript(videoUrl);
      } else if (platform === 'bilibili') {
        transcript = await this.bilibiliService.getSubtitle(videoUrl);
      }
      
      // å¦‚æœæ²¡æœ‰å­—å¹•ï¼Œä½¿ç”¨è¯­éŸ³è¯†åˆ«
      if (!transcript || transcript.length === 0) {
        this.logger.log('æœªæ‰¾åˆ°å­—å¹•ï¼Œä½¿ç”¨ç§‘å¤§è®¯é£è½¬å½•');
        
        // 1. å…ˆæå–éŸ³é¢‘
        const audioPath = await this.xfyunService.extractAudio(videoUrl);
        
        // 2. è°ƒç”¨ç§‘å¤§è®¯é£ API è½¬å†™éŸ³é¢‘
        transcript = await this.xfyunService.transcribe(audioPath);
        
        // 3. æ¸…ç†ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
        await this.xfyunService.cleanupAudio(audioPath);
        
        transcriptSource = 'asr';
      }
      
      await job.updateProgress(60);
      
      // ç›´æ¥ä½¿ç”¨è¯†åˆ«çš„å­—å¹•ï¼Œä¸è¿›è¡Œå¤§æ¨¡å‹æ ¼å¼è§„æ•´
      // ç§‘å¤§è®¯é£/YouTube/Bç«™è¯†åˆ«çš„åˆ†æ®µå·²ç»è¶³å¤Ÿå¥½ï¼Œæ— éœ€é¢å¤–å¤„ç†
      
      // ä¿å­˜ segments
      const segments = transcript.map((item, index) => ({
        documentId,
        segmentIndex: index,
        text: item.text,
        startTime: item.start,
        endTime: item.end,
      }));
      
      await this.segmentModel.insertMany(segments);
      
      await job.updateProgress(80);
      
      // æ›´æ–°æ–‡æ¡£çŠ¶æ€
      await this.documentModel.updateOne(
        { _id: documentId },
        {
          status: 'completed',
          'video.transcriptSource': transcriptSource,
          wordCount: formattedTranscript.reduce((sum, t) => sum + t.text.length, 0),
        }
      );
      
      await job.updateProgress(100);
      
      this.logger.log(`è§†é¢‘ä»»åŠ¡å®Œæˆ: ${job.id}`);
      
      return { success: true, documentId };
      
    } catch (error) {
      this.logger.error(`è§†é¢‘ä»»åŠ¡å¤±è´¥: ${job.id}`, error);
      
      await this.documentModel.updateOne(
        { _id: documentId },
        {
          status: 'failed',
          errorMessage: error.message,
        }
      );
      
      throw error;
    }
  }
  
  private parseVideoPlatform(url: string): 'youtube' | 'bilibili' {
    if (url.includes('youtube.com') || url.includes('youtu.be')) {
      return 'youtube';
    } else if (url.includes('bilibili.com')) {
      return 'bilibili';
    }
    throw new Error('ä¸æ”¯æŒçš„è§†é¢‘å¹³å°');
  }
}
```

---

## ğŸ”§ ç¬¬ä¸‰æ–¹æœåŠ¡é€‰å‹

### 1. PDFè½¬æ–‡æœ¬æ–¹æ¡ˆ

**æ¨èæ–¹æ¡ˆï¼š**

#### æ–¹æ¡ˆAï¼špdf-parseï¼ˆå¼€æºå…è´¹ï¼‰
- **ä¼˜ç‚¹**ï¼šå®Œå…¨å…è´¹ï¼Œé€‚åˆç®€å•PDF
- **ç¼ºç‚¹**ï¼šä¸æ”¯æŒæ‰«æç‰ˆPDFï¼ˆOCRï¼‰
- **é€‚ç”¨**ï¼šMVPé˜¶æ®µï¼Œé¢„ç®—æœ‰é™
- **å®ç°**ï¼šNode.jsç«¯ä½¿ç”¨ `pdf-parse` åº“

#### æ–¹æ¡ˆBï¼šé˜¿é‡Œäº‘æ™ºèƒ½æ–‡æ¡£è§£æï¼ˆä»˜è´¹ï¼‰
- **ä¼˜ç‚¹**ï¼šæ”¯æŒå¤æ‚æ’ç‰ˆã€OCRã€è¡¨æ ¼è¯†åˆ«
- **ä»·æ ¼**ï¼š0.03å…ƒ/é¡µï¼ˆé¦–æœˆå…è´¹é¢åº¦ï¼‰
- **API**ï¼šhttps://help.aliyun.com/document_detail/442276.html
- **æ¨è**ï¼šæ­£å¼ä¸Šçº¿åä½¿ç”¨

#### æ–¹æ¡ˆCï¼šXata.io File Attachmentsï¼ˆæ··åˆæ–¹æ¡ˆï¼‰
- **ä¼˜ç‚¹**ï¼šé›†æˆåº¦é«˜ï¼ŒåŒ…å«PDFæ–‡æœ¬æå–
- **ä»·æ ¼**ï¼šå…è´¹é¢åº¦è¶³å¤ŸMVP
- **æ¨èæŒ‡æ•°**ï¼šâ­â­â­â­

**å»ºè®®**ï¼šç›®å‰å…ˆè¯•ç”¨æ–¹æ¡ˆAï¼Œåç»­å†è€ƒè™‘æ–¹æ¡ˆBæˆ–C

### 2. è§†é¢‘å­—å¹•è·å–

#### YouTube
- ä½¿ç”¨ `youtube-transcript-api`ï¼ˆPythonï¼‰æˆ– `youtube-transcript`ï¼ˆNode.jsï¼‰
- æ”¯æŒè‡ªåŠ¨å­—å¹•å’Œäººå·¥å­—å¹•

#### Bç«™
- ä½¿ç”¨Bç«™APIè·å–å­—å¹•ï¼š`https://api.bilibili.com/x/player/v2`
- éœ€è¦å¤„ç†ç™»å½•æ€å’Œåçˆ¬

#### è¯­éŸ³è¯†åˆ«å…œåº•ï¼ˆç§‘å¤§è®¯é£ï¼‰

**âš ï¸ é‡è¦è¯´æ˜**ï¼šç§‘å¤§è®¯é£è¯­éŸ³è½¬å†™ API **ä¸æ”¯æŒç›´æ¥å¤„ç†è§†é¢‘é“¾æ¥**ï¼Œéœ€è¦å…ˆæå–éŸ³é¢‘æ–‡ä»¶ã€‚

##### å®Œæ•´æµç¨‹

```
è§†é¢‘é“¾æ¥ â†’ ä¸‹è½½è§†é¢‘/æå–éŸ³é¢‘ â†’ è½¬æ¢ä¸ºéŸ³é¢‘æ ¼å¼ â†’ ä¸Šä¼ ç§‘å¤§è®¯é£ â†’ è·å–è½¬å†™ç»“æœ
```

##### å®ç°æ–¹æ¡ˆ

**æ–¹æ¡ˆAï¼šä½¿ç”¨ yt-dlpï¼ˆæ¨èï¼‰âœ…**
- **å·¥å…·**ï¼š`yt-dlp`ï¼ˆyoutube-dl çš„å¢å¼ºç‰ˆï¼‰
- **æ”¯æŒå¹³å°**ï¼šYouTubeã€Bilibiliã€1000+ è§†é¢‘ç½‘ç«™
- **åŠŸèƒ½**ï¼šç›´æ¥æå–éŸ³é¢‘ï¼Œæ— éœ€ä¸‹è½½å®Œæ•´è§†é¢‘
- **æ ¼å¼**ï¼šæ”¯æŒå¯¼å‡º MP3ã€WAVã€M4A ç­‰
- **ä¼˜ç‚¹**ï¼šå¿«é€Ÿã€èŠ‚çœå¸¦å®½ã€æ ¼å¼æ”¯æŒå¹¿
- **å®‰è£…**ï¼šé€šè¿‡ npm çš„ `@distube/yt-dlp` æˆ–ç³»ç»Ÿå‘½ä»¤
- **æµ‹è¯•çŠ¶æ€**ï¼šâœ… å·²éªŒè¯å¯è¡Œ

##### æå–éŸ³é¢‘ç¤ºä¾‹

**åŸºç¡€ç”¨æ³•ï¼ˆYouTubeï¼‰ï¼š**
```bash
# ç›´æ¥æå– MP3ï¼ˆéœ€è¦ ffmpegï¼‰
yt-dlp -x --audio-format mp3 --audio-quality 0 [è§†é¢‘é“¾æ¥] -o output.mp3

# ä¸‹è½½æœ€ä½³éŸ³é¢‘æ ¼å¼ï¼ˆä¸è½¬æ¢ï¼Œæ¨èï¼‰
yt-dlp -f bestaudio [è§†é¢‘é“¾æ¥] -o output.%(ext)s
```

**Bç«™ç‰¹æ®Šå¤„ç†ï¼ˆéœ€è¦ cookiesï¼‰ï¼š**
```bash
# Bç«™éœ€è¦ä»æµè§ˆå™¨å¯¼å…¥ cookies æ¥ç»•è¿‡åçˆ¬è™«
yt-dlp --cookies-from-browser chrome -f bestaudio [Bç«™é“¾æ¥] -o output.%(ext)s
```

##### å®é™…æµ‹è¯•ç»“æœ

**æµ‹è¯•è§†é¢‘**ï¼š`https://www.bilibili.com/video/BV1FFygBgEUE/`

**æµ‹è¯•å‘½ä»¤**ï¼š
```bash
yt-dlp --cookies-from-browser chrome -f bestaudio \
  "https://www.bilibili.com/video/BV1FFygBgEUE/" \
  -o "bilibili_test.%(ext)s"
```

**æµ‹è¯•ç»“æœ**ï¼š
- âœ… æˆåŠŸæå–éŸ³é¢‘
- âœ… æ–‡ä»¶æ ¼å¼ï¼šM4Aï¼ˆç§‘å¤§è®¯é£æ”¯æŒï¼‰
- âœ… æ–‡ä»¶å¤§å°ï¼š9.3 MB
- âœ… ä¸‹è½½é€Ÿåº¦ï¼š3.24 MiB/s
- âœ… è€—æ—¶ï¼šçº¦ 2 ç§’

**å…³é”®å‘ç°**ï¼š
1. **Bç«™å¿…é¡»ä½¿ç”¨ cookies**ï¼šç›´æ¥è®¿é—®ä¼šè¿”å› `HTTP Error 412`
2. **æ— éœ€ ffmpeg**ï¼šä½¿ç”¨ `-f bestaudio` å¯ç›´æ¥ä¸‹è½½éŸ³é¢‘ï¼Œæ— éœ€è½¬æ¢
3. **æ ¼å¼å…¼å®¹**ï¼šä¸‹è½½çš„ M4A æ ¼å¼ç§‘å¤§è®¯é£ç›´æ¥æ”¯æŒ
4. **cookies æ¥æº**ï¼šæ”¯æŒ chromeã€firefoxã€safariã€edge ç­‰æµè§ˆå™¨

**æ–¹æ¡ˆBï¼šä½¿ç”¨ fluent-ffmpeg**
- **å·¥å…·**ï¼š`fluent-ffmpeg` + `ffmpeg`
- **æµç¨‹**ï¼šå…ˆä¸‹è½½è§†é¢‘ â†’ ç”¨ ffmpeg æå–éŸ³é¢‘
- **ç¼ºç‚¹**ï¼šéœ€è¦ä¸‹è½½å®Œæ•´è§†é¢‘ï¼Œè¾ƒæ…¢

##### éŸ³é¢‘æ ¼å¼è¦æ±‚

ç§‘å¤§è®¯é£è¯­éŸ³è½¬å†™ API æ”¯æŒçš„éŸ³é¢‘æ ¼å¼ï¼š
- **æ ¼å¼**ï¼šMP3ã€WAVã€FLACã€**M4A**ã€AAC
- **é‡‡æ ·ç‡**ï¼š8000Hz / 16000Hzï¼ˆæ¨è 16000Hzï¼‰
- **å£°é“**ï¼šå•å£°é“ / åŒå£°é“
- **ç ç‡**ï¼šå»ºè®® 128kbps ä»¥ä¸Š
- **æ–‡ä»¶å¤§å°**ï¼šå•æ–‡ä»¶æœ€å¤§ 500MB

**âœ… æ¨è**ï¼šyt-dlp ä½¿ç”¨ `-f bestaudio` ä¸‹è½½çš„ M4A æ ¼å¼å®Œå…¨ç¬¦åˆè¦æ±‚ï¼Œæ— éœ€è½¬æ¢ï¼

##### B ç«™è§†é¢‘å¤„ç†ç‰¹åˆ«è¯´æ˜

**é—®é¢˜**ï¼šB ç«™æœ‰ä¸¥æ ¼çš„åçˆ¬è™«æœºåˆ¶ï¼Œç›´æ¥ä½¿ç”¨ yt-dlp ä¼šè¿”å› `HTTP Error 412: Precondition Failed`

**è§£å†³æ–¹æ¡ˆ**ï¼šä½¿ç”¨ `--cookies-from-browser` å‚æ•°

```typescript
// æ£€æµ‹ B ç«™å¹¶æ·»åŠ  cookies å‚æ•°
const isBilibili = videoUrl.includes('bilibili.com');
let command = 'yt-dlp';

if (isBilibili) {
  command += ' --cookies-from-browser chrome';  // ä» Chrome å¯¼å…¥ cookies
}

command += ` -f bestaudio "${videoUrl}" -o "${outputPath}.%(ext)s"`;
```

**å‰ç½®æ¡ä»¶**ï¼š
- âœ… æœåŠ¡å™¨ä¸Šå®‰è£…äº† Chrome æµè§ˆå™¨ï¼ˆæˆ– Firefox/Safari/Edgeï¼‰
- âœ… æµè§ˆå™¨ä¸­å·²ç™»å½•è¿‡ B ç«™è´¦å·
- âš ï¸ éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒæ—¶éœ€è¦é…ç½®æµè§ˆå™¨å’Œç™»å½•æ€

**ç”Ÿäº§ç¯å¢ƒå»ºè®®**ï¼š
1. åœ¨ Docker å®¹å™¨ä¸­å®‰è£… Chromiumï¼š
   ```dockerfile
   RUN apt-get install -y chromium chromium-driver
   ```
2. ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬å®šæœŸåˆ·æ–° B ç«™ç™»å½•æ€
3. æˆ–è€…å¯¼å‡º cookies æ–‡ä»¶ï¼š`yt-dlp --cookies cookies.txt`

##### ç§‘å¤§è®¯é£ API æ¥å…¥

- **æœåŠ¡**ï¼šå®æ—¶è¯­éŸ³è½¬å†™ / å½•éŸ³æ–‡ä»¶è½¬å†™ï¼ˆæ¨èåè€…ï¼‰
- **ä»·æ ¼**ï¼šçº¦ 0.5å…ƒ/å°æ—¶
- **æ¥å£æ–‡æ¡£**ï¼šhttps://www.xfyun.cn/doc/asr/lfasr/API.html
- **è¿”å›æ ¼å¼**ï¼šJSONï¼ŒåŒ…å«æ—¶é—´æˆ³å’Œæ–‡æœ¬

##### åç«¯æœåŠ¡å®ç°ï¼ˆ`xfyun.service.ts`ï¼‰

```typescript
import { Injectable, Logger } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import { exec } from 'child_process';
import { promisify } from 'util';
import * as fs from 'fs';
import * as path from 'path';
import axios from 'axios';
import * as crypto from 'crypto';

const execAsync = promisify(exec);

@Injectable()
export class XfyunService {
  private readonly logger = new Logger(XfyunService.name);
  private readonly appId: string;
  private readonly secretKey: string;
  private readonly tempDir = './temp/audio';

  constructor(private configService: ConfigService) {
    this.appId = this.configService.get('XFYUN_APP_ID');
    this.secretKey = this.configService.get('XFYUN_SECRET_KEY');
    
    // ç¡®ä¿ä¸´æ—¶ç›®å½•å­˜åœ¨
    if (!fs.existsSync(this.tempDir)) {
      fs.mkdirSync(this.tempDir, { recursive: true });
    }
  }

  /**
   * ä»è§†é¢‘é“¾æ¥æå–éŸ³é¢‘
   * ä½¿ç”¨ yt-dlp ç›´æ¥æå–éŸ³é¢‘ï¼ˆæ— éœ€ä¸‹è½½å®Œæ•´è§†é¢‘ï¼‰
   * 
   * âš ï¸ Bç«™ç‰¹åˆ«è¯´æ˜ï¼š
   * - Bç«™æœ‰ä¸¥æ ¼çš„åçˆ¬è™«æœºåˆ¶ï¼Œç›´æ¥è®¿é—®ä¼šè¿”å› 412 é”™è¯¯
   * - å¿…é¡»ä½¿ç”¨ --cookies-from-browser å‚æ•°ä»æµè§ˆå™¨å¯¼å…¥ cookies
   * - æ”¯æŒçš„æµè§ˆå™¨ï¼šchrome, firefox, safari, edge ç­‰
   */
  async extractAudio(videoUrl: string): Promise<string> {
    this.logger.log(`å¼€å§‹æå–éŸ³é¢‘: ${videoUrl}`);
    
    const timestamp = Date.now();
    const outputPath = path.join(this.tempDir, `${timestamp}`);
    
    try {
      // æ£€æµ‹æ˜¯å¦ä¸º B ç«™è§†é¢‘
      const isBilibili = videoUrl.includes('bilibili.com');
      
      // æ„å»º yt-dlp å‘½ä»¤
      // -f bestaudio: ä¸‹è½½æœ€ä½³éŸ³é¢‘è´¨é‡
      // --cookies-from-browser chrome: Bç«™éœ€è¦ä»æµè§ˆå™¨å¯¼å…¥cookies
      let command = 'yt-dlp';
      
      if (isBilibili) {
        // Bç«™éœ€è¦ cookies è®¤è¯
        command += ' --cookies-from-browser chrome';
      }
      
      // ç›´æ¥ä¸‹è½½æœ€ä½³éŸ³é¢‘æ ¼å¼ï¼ˆä¸è½¬æ¢ï¼Œé¿å…ä¾èµ– ffmpegï¼‰
      // ç§‘å¤§è®¯é£æ”¯æŒ M4A, MP3, WAV ç­‰æ ¼å¼
      command += ` -f bestaudio "${videoUrl}" -o "${outputPath}.%(ext)s"`;
      
      this.logger.log(`æ‰§è¡Œå‘½ä»¤: ${command}`);
      await execAsync(command, { timeout: 600000 }); // 10åˆ†é’Ÿè¶…æ—¶
      
      // æŸ¥æ‰¾ç”Ÿæˆçš„æ–‡ä»¶ï¼ˆå¯èƒ½æ˜¯ .m4a æˆ– .webm ç­‰ï¼‰
      const files = fs.readdirSync(this.tempDir)
        .filter(f => f.startsWith(timestamp.toString()));
      
      if (files.length === 0) {
        throw new Error('éŸ³é¢‘æ–‡ä»¶æœªç”Ÿæˆ');
      }
      
      const audioPath = path.join(this.tempDir, files[0]);
      this.logger.log(`éŸ³é¢‘æå–å®Œæˆ: ${audioPath}`);
      return audioPath;
      
    } catch (error) {
      this.logger.error(`éŸ³é¢‘æå–å¤±è´¥: ${error.message}`);
      throw new Error(`éŸ³é¢‘æå–å¤±è´¥: ${error.message}`);
    }
  }

  /**
   * è°ƒç”¨ç§‘å¤§è®¯é£å½•éŸ³æ–‡ä»¶è½¬å†™ API
   */
  async transcribe(audioPath: string): Promise<Array<{ text: string; start: number; end: number }>> {
    this.logger.log(`å¼€å§‹è½¬å†™éŸ³é¢‘: ${audioPath}`);
    
    try {
      // 1. ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
      const taskId = await this.uploadAudio(audioPath);
      
      // 2. è½®è¯¢è·å–è½¬å†™ç»“æœ
      const result = await this.pollTranscriptResult(taskId);
      
      // 3. è§£æç»“æœ
      return this.parseTranscriptResult(result);
      
    } catch (error) {
      this.logger.error(`éŸ³é¢‘è½¬å†™å¤±è´¥: ${error.message}`);
      throw new Error(`éŸ³é¢‘è½¬å†™å¤±è´¥: ${error.message}`);
    }
  }

  /**
   * ä¸Šä¼ éŸ³é¢‘æ–‡ä»¶åˆ°ç§‘å¤§è®¯é£
   */
  private async uploadAudio(audioPath: string): Promise<string> {
    const ts = Math.floor(Date.now() / 1000).toString();
    const baseString = this.appId + ts;
    const signa = crypto.createHash('md5')
      .update(baseString + this.secretKey)
      .digest('hex');

    const formData = new FormData();
    formData.append('file', fs.createReadStream(audioPath));
    
    const response = await axios.post(
      'https://raasr.xfyun.cn/api/upload',
      formData,
      {
        headers: {
          'appId': this.appId,
          'signa': signa,
          'ts': ts,
        },
      }
    );

    if (response.data.ok === 0) {
      return response.data.data;
    } else {
      throw new Error(`ç§‘å¤§è®¯é£ä¸Šä¼ å¤±è´¥: ${response.data.failed}`);
    }
  }

  /**
   * è½®è¯¢è·å–è½¬å†™ç»“æœ
   */
  private async pollTranscriptResult(taskId: string): Promise<any> {
    const maxAttempts = 60; // æœ€å¤šè½®è¯¢60æ¬¡ï¼ˆ5åˆ†é’Ÿï¼‰
    let attempts = 0;

    while (attempts < maxAttempts) {
      await new Promise(resolve => setTimeout(resolve, 5000)); // æ¯5ç§’è½®è¯¢ä¸€æ¬¡

      const ts = Math.floor(Date.now() / 1000).toString();
      const baseString = this.appId + ts;
      const signa = crypto.createHash('md5')
        .update(baseString + this.secretKey)
        .digest('hex');

      const response = await axios.get(
        `https://raasr.xfyun.cn/api/getResult?taskId=${taskId}`,
        {
          headers: {
            'appId': this.appId,
            'signa': signa,
            'ts': ts,
          },
        }
      );

      if (response.data.ok === 0) {
        const status = response.data.data?.status;
        
        if (status === 9) {
          // è½¬å†™å®Œæˆ
          return response.data.data;
        } else if (status < 0) {
          // è½¬å†™å¤±è´¥
          throw new Error(`è½¬å†™å¤±è´¥ï¼ŒçŠ¶æ€ç : ${status}`);
        }
        // ç»§ç»­ç­‰å¾…
      }

      attempts++;
    }

    throw new Error('è½¬å†™è¶…æ—¶');
  }

  /**
   * è§£æç§‘å¤§è®¯é£è¿”å›çš„è½¬å†™ç»“æœ
   */
  private parseTranscriptResult(result: any): Array<{ text: string; start: number; end: number }> {
    const segments = [];
    
    // ç§‘å¤§è®¯é£è¿”å›æ ¼å¼è§£æ
    if (result.data) {
      const lines = result.data.split('\n');
      
      for (const line of lines) {
        if (!line.trim()) continue;
        
        try {
          const json = JSON.parse(line);
          
          // è§£ææ¯ä¸ªå¥å­
          if (json.onebest) {
            const startTime = json.bg / 1000; // æ¯«ç§’è½¬ç§’
            const endTime = json.ed / 1000;
            const text = json.onebest;
            
            segments.push({
              text,
              start: startTime,
              end: endTime,
            });
          }
        } catch (e) {
          this.logger.warn(`è§£æè¡Œå¤±è´¥: ${line}`);
        }
      }
    }
    
    return segments;
  }

  /**
   * æ¸…ç†ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
   */
  async cleanupAudio(audioPath: string): Promise<void> {
    try {
      if (fs.existsSync(audioPath)) {
        fs.unlinkSync(audioPath);
        this.logger.log(`å·²æ¸…ç†ä¸´æ—¶æ–‡ä»¶: ${audioPath}`);
      }
    } catch (error) {
      this.logger.warn(`æ¸…ç†æ–‡ä»¶å¤±è´¥: ${error.message}`);
    }
  }
}
```

##### MoonshotService - å­—å¹•æ ¼å¼è§„æ•´æ–¹æ³•ï¼ˆ`moonshot.service.ts`ï¼‰

```typescript
import { Injectable, Logger } from '@nestjs/common';
import { ConfigService } from '@nestjs/config';
import OpenAI from 'openai';

/**
 * Moonshot AI æœåŠ¡
 * ç”¨äºçŸ¥è¯†ç‚¹æç‚¼å’Œæ´å¯Ÿç”Ÿæˆ
 */
@Injectable()
export class MoonshotService {
  private readonly logger = new Logger(MoonshotService.name);
  private readonly client: OpenAI | null;
  private readonly timeout: number;
  private readonly maxRetries: number;
  private readonly retryDelay: number;

  constructor(private configService: ConfigService) {
    const apiKey = this.configService.get<string>('MOONSHOT_API_KEY');
    const baseURL =
      this.configService.get<string>('MOONSHOT_BASE_URL') ||
      'https://api.moonshot.cn/v1';

    // é…ç½®è¶…æ—¶å’Œé‡è¯•ç­–ç•¥
    this.timeout = this.configService.get<number>('MOONSHOT_TIMEOUT') || 60000;
    this.maxRetries =
      this.configService.get<number>('MOONSHOT_MAX_RETRIES') || 2;
    this.retryDelay =
      this.configService.get<number>('MOONSHOT_RETRY_DELAY') || 1000;

    if (apiKey) {
      this.client = new OpenAI({
        apiKey,
        baseURL,
        maxRetries: 0, // ç¦ç”¨ SDK å†…ç½®é‡è¯•ï¼Œä½¿ç”¨è‡ªå®šä¹‰é‡è¯•é€»è¾‘
      });
      this.logger.log(
        `Moonshot AI å®¢æˆ·ç«¯åˆå§‹åŒ–æˆåŠŸ (timeout: ${this.timeout}ms, maxRetries: ${this.maxRetries})`,
      );
    } else {
      this.logger.warn('Moonshot API Key æœªé…ç½®ï¼ŒçŸ¥è¯†ç‚¹æç‚¼åŠŸèƒ½å°†ä¸å¯ç”¨');
      this.client = null;
    }
  }

  /**
   * æ£€æŸ¥æœåŠ¡æ˜¯å¦å¯ç”¨
   */
  isAvailable(): boolean {
    return this.client !== null;
  }

  /**
   * ä»å†…å®¹ä¸­æç‚¼çŸ¥è¯†ç‚¹
   * - ä»å®Œæ•´å†…å®¹ä¸­æå–3-8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹
   * - æ¯ä¸ªçŸ¥è¯†ç‚¹åŒ…å«ä¸»é¢˜ã€åŸæ–‡æ‘˜å½•ã€ä½ç½®ä¿¡æ¯
   * - æŒ‰é‡è¦æ€§æ’åº
   *
   * @param contentText å®Œæ•´å†…å®¹æ–‡æœ¬
   * @param segments åˆ†æ®µä¿¡æ¯ï¼Œæ ¼å¼: [{ text: string, start?: number, end?: number, segmentId?: string }]
   * @param options å¯é€‰å‚æ•°
   * @returns çŸ¥è¯†ç‚¹æ•°ç»„
   */
  async extractKnowledgePoints(
    contentText: string,
    segments: Array<{
      text: string;
      start?: number;
      end?: number;
      segmentId?: string;
    }>,
    options?: {
      maxPoints?: number;
      userRole?: string;
      userGoal?: string;
    },
  ): Promise<
    Array<{
      topic: string;
      excerpt: string;
      segmentId?: string;
      confidenceScore: number;
      displayOrder: number;
    }>
  > {
    // å®ç°ç»†èŠ‚ï¼šè°ƒç”¨ Moonshot APIï¼Œä½¿ç”¨ Prompt å·¥ç¨‹æç‚¼çŸ¥è¯†ç‚¹
    // åŒ…å«é‡è¯•é€»è¾‘ã€è¶…æ—¶æ§åˆ¶ã€é”™è¯¯å¤„ç†ç­‰
    // ...
  }
}
```

##### åç«¯ä¾èµ–æ›´æ–°

éœ€è¦åœ¨ `backend/package.json` æ·»åŠ ï¼š

```json
{
  "dependencies": {
    "@distube/yt-dlp": "^1.0.4",  // Node.js çš„ yt-dlp åŒ…è£…å™¨
    "form-data": "^4.0.0"         // ç”¨äºä¸Šä¼ éŸ³é¢‘æ–‡ä»¶
  }
}
```

##### ç³»ç»Ÿä¾èµ–

éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šå®‰è£… `yt-dlp`ï¼š

```bash
# æ–¹å¼1: pip å®‰è£…ï¼ˆæ¨èï¼‰
pip install yt-dlp

# æ–¹å¼2: ä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶
curl -L https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -o /usr/local/bin/yt-dlp
chmod a+rx /usr/local/bin/yt-dlp
```

##### Docker éƒ¨ç½²é…ç½®

åœ¨ `Dockerfile` ä¸­æ·»åŠ ï¼š

```dockerfile
# å®‰è£… yt-dlpï¼ˆffmpeg å¯é€‰ï¼Œä½¿ç”¨ -f bestaudio å¯é¿å…ä¾èµ–ï¼‰
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    && pip3 install yt-dlp \
    && rm -rf /var/lib/apt/lists/*

# å¦‚æœéœ€è¦è½¬æ¢éŸ³é¢‘æ ¼å¼ï¼ˆMP3ï¼‰ï¼Œå¯ä»¥å®‰è£… ffmpeg
# RUN apt-get install -y ffmpeg
```

**è¯´æ˜**ï¼š
- âœ… **æ¨èæ–¹å¼**ï¼šä½¿ç”¨ `-f bestaudio` ç›´æ¥ä¸‹è½½éŸ³é¢‘ï¼Œæ— éœ€ ffmpeg
- âš ï¸ **å¯é€‰æ–¹å¼**ï¼šå¦‚æœè¦è½¬æ¢ä¸º MP3ï¼Œéœ€è¦å®‰è£… ffmpegï¼ˆå¢åŠ é•œåƒå¤§å°çº¦ 50MBï¼‰
- ğŸ“ **å®æµ‹**ï¼šM4A æ ¼å¼ç§‘å¤§è®¯é£å®Œå…¨æ”¯æŒï¼Œæ— éœ€è½¬æ¢

---

## ğŸ¯ åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

## ç¬¬ä¸€é˜¶æ®µï¼šé¡¹ç›®åŸºç¡€æ­å»ºï¼ˆç¬¬1-2å‘¨ï¼‰

### ç›®æ ‡
æ­å»ºé¡¹ç›®éª¨æ¶ï¼Œå®ŒæˆåŸºç¡€åŠŸèƒ½æ¨¡å—

### ä»»åŠ¡æ¸…å•

#### 1.1 é¡¹ç›®åˆå§‹åŒ–

**1.1.1 åˆ›å»ºé¡¹ç›®æ ¹ç›®å½•ç»“æ„**
- [x] åˆ›å»ºé¡¹ç›®æ ¹ç›®å½• `knowlens/`
- [x] åœ¨æ ¹ç›®å½•åˆ›å»º `.gitignore`ï¼ˆåŒ…å«å‰åç«¯å¿½ç•¥è§„åˆ™ï¼‰
- [x] åˆ›å»ºé¡¹ç›®æ ¹ç›®å½• `README.md`

**1.1.2 å‰ç«¯é¡¹ç›®åˆå§‹åŒ–**
- [x] åœ¨ `knowlens/` ä¸‹åˆ›å»º `frontend/` ç›®å½•
- [x] ä½¿ç”¨ Vite åˆ›å»º React + TypeScript é¡¹ç›®
- [x] é…ç½® ESLintã€Prettier
- [x] é…ç½®ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆ`.env.development` / `.env.production`ï¼‰
- [x] å®‰è£…å¹¶é…ç½® Ant Design 5.x ç»„ä»¶åº“
- [x] é…ç½® Ant Design ä¸»é¢˜ï¼ˆä½¿ç”¨ä¸»é¢˜è‰² `#3BAF9F`ï¼‰
- [x] å®‰è£…å¹¶é…ç½® React Router v6
- [x] å®‰è£…å¹¶é…ç½® zustand çŠ¶æ€ç®¡ç†
- [x] å®‰è£… axios å¹¶é…ç½®åŸºç¡€è¯·æ±‚å°è£…
- [x] åˆ›å»ºå‰ç«¯åŸºç¡€ç›®å½•ç»“æ„ï¼ˆpagesã€componentsã€storesã€apiã€utilsã€hooksã€routerç­‰ï¼‰
- [x] é…ç½®å…¨å±€æ ·å¼å’Œ CSS å˜é‡ï¼ˆä¸»é¢˜é¢œè‰²ï¼‰

**1.1.3 åç«¯é¡¹ç›®åˆå§‹åŒ–**
- [x] åœ¨ `knowlens/` ä¸‹åˆ›å»º `backend/` ç›®å½•
- [x] ä½¿ç”¨ Nest.js CLI åˆ›å»º Nest.js + TypeScript é¡¹ç›®
- [x] é…ç½® ESLintã€Prettier
- [x] é…ç½®ç¯å¢ƒå˜é‡ç®¡ç†ï¼ˆ`.env.development` / `.env.production`ï¼‰
- [x] å®‰è£…å¹¶é…ç½® `@nestjs/config` é…ç½®ç®¡ç†
- [x] é…ç½® Swagger API æ–‡æ¡£
- [x] é…ç½® CORSï¼ˆå…è®¸æºå¸¦ cookieï¼‰
- [x] å®‰è£…å¹¶é…ç½® `cookie-parser` ä¸­é—´ä»¶
- [x] åˆ›å»ºåç«¯åŸºç¡€ç›®å½•ç»“æ„ï¼ˆmodulesã€commonã€configã€sharedã€utilsç­‰ï¼‰
- [x] é…ç½®å…¨å±€å¼‚å¸¸è¿‡æ»¤å™¨ã€æ‹¦æˆªå™¨ã€ç®¡é“

#### 1.2 æ•°æ®åº“è®¾è®¡ä¸é…ç½®

**1.2.1 MongoDBé…ç½®**
- [x] å®‰è£…é…ç½® MongoDBï¼ˆæœ¬åœ°æˆ–ä½¿ç”¨ MongoDB Atlasï¼‰
- [x] å®‰è£… `@nestjs/mongoose` å’Œ `mongoose`
- [x] é…ç½® MongoDB è¿æ¥ï¼ˆ`config/database.config.ts`ï¼‰
- [x] è®¾ç½® Mongooseï¼Œç¼–å†™æ‰€æœ‰ Schema æ¨¡å‹ï¼š
  - [x] User Schemaï¼ˆusersé›†åˆï¼‰
  - [x] Document Schemaï¼ˆdocumentsé›†åˆï¼‰
  - [x] Segment Schemaï¼ˆsegmentsé›†åˆï¼‰
  - [x] KnowledgePoint Schemaï¼ˆknowledge_pointsé›†åˆï¼‰
  - [x] Insight Schemaï¼ˆinsightsé›†åˆï¼‰
  - [x] SmsCode Schemaï¼ˆsms_verification_codesé›†åˆï¼‰
- [x] åˆ›å»ºæ‰€æœ‰ Mongoose Models
- [x] é…ç½®æ•°æ®åº“è¿æ¥å’Œé”™è¯¯å¤„ç†
- [x] åˆ›å»ºæ•°æ®åº“ç´¢å¼•ï¼ˆæ ¹æ® Schema å®šä¹‰ï¼‰

**1.2.2 Redisé…ç½®**
- [x] å®‰è£…é…ç½® Redisï¼ˆæœ¬åœ°å¼€å‘ç¯å¢ƒï¼‰- éœ€è¦æ‰‹åŠ¨å®‰è£…ï¼Œè¯¦è§ Rediså®‰è£…æŒ‡å—.md
- [x] å®‰è£… `ioredis`ã€`@nestjs/bullmq`ã€`bullmq`
- [x] é…ç½® Redis è¿æ¥ï¼ˆ`config/redis.config.ts`ï¼‰
- [x] é…ç½® BullMQ æ¨¡å—ï¼ˆåŸºç¡€é…ç½®ï¼Œå…·ä½“é˜Ÿåˆ—åœ¨åç»­é˜¶æ®µåˆ›å»ºï¼‰

#### 1.3 ç”¨æˆ·è®¤è¯ç³»ç»Ÿ

**1.3.1 åç«¯è®¤è¯æ¨¡å—**
- [x] åˆ›å»º `auth` æ¨¡å—ï¼ˆauth.module.tsã€auth.controller.tsã€auth.service.tsï¼‰
- [x] åˆ›å»ºè®¤è¯ç›¸å…³ DTOï¼ˆsend-code.dto.tsã€verify-code.dto.tsï¼‰
- [x] é›†æˆé˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡SDK
- [x] å®ç°éªŒè¯ç å‘é€API (`POST /api/auth/send-code`)
- [x] å®ç°éªŒè¯ç éªŒè¯+ç™»å½•API (`POST /api/auth/verify`)
- [x] å®ç°é€€å‡ºç™»å½•API (`POST /api/auth/logout`)
- [x] é…ç½® JWT æ¨¡å—ï¼ˆ@nestjs/jwtï¼‰
- [x] åˆ›å»º JWT è®¤è¯å®ˆå«ï¼ˆjwt-auth.guard.tsï¼‰
- [x] åˆ›å»º JWT ç­–ç•¥ï¼ˆjwt.strategy.tsï¼‰
- [x] åˆ›å»ºç”¨æˆ·è£…é¥°å™¨ï¼ˆ@User() decoratorï¼‰
- [x] å®ç°ç™»å½•æ—¶è®¾ç½® HttpOnly Cookie

**1.3.2 å‰ç«¯è®¤è¯åŠŸèƒ½**
- [x] åˆ›å»º `authStore`ï¼ˆzustand çŠ¶æ€ç®¡ç†ï¼‰
- [x] åˆ›å»ºè®¤è¯ç›¸å…³ API å°è£…ï¼ˆ`api/auth.ts`ï¼‰
- [x] é…ç½® axios è¯·æ±‚æ‹¦æˆªå™¨å’Œå“åº”æ‹¦æˆªå™¨
- [x] å®ç° 401 è‡ªåŠ¨æ‰“å¼€ç™»å½•å¼¹çª—
- [x] åˆ›å»ºç™»å½•å¼¹çª—ç»„ä»¶ï¼ˆ`components/LoginModal`ï¼‰
- [x] å®ç°éªŒè¯ç å‘é€å’Œå€’è®¡æ—¶åŠŸèƒ½
- [x] å®ç°ç™»å½•æˆåŠŸåä¿å­˜ç”¨æˆ·ä¿¡æ¯

#### 1.4 ç”¨æˆ·æ¨¡å—

**1.4.1 åç«¯ç”¨æˆ·æ¨¡å—**
- [x] åˆ›å»º `user` æ¨¡å—ï¼ˆuser.module.tsã€user.controller.tsã€user.service.tsï¼‰
- [x] åˆ›å»ºç”¨æˆ· Schemaï¼ˆuser.schema.tsï¼‰
- [x] å®ç°ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢API (`GET /api/user/profile`)
- [x] å®ç°ç”¨æˆ·ä¿¡æ¯ä¿®æ”¹API (`PATCH /api/user/profile`)
- [x] å®ç°å¤´åƒä¸Šä¼ åŠŸèƒ½ï¼ˆä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSSï¼‰

**1.4.2 å‰ç«¯ç”¨æˆ·åŠŸèƒ½**
- [x] æ·»åŠ user-settingé¡µé¢ï¼Œç”¨äºç”¨æˆ·ä¿¡æ¯ä¿®æ”¹
- [x] åˆ›å»ºç”¨æˆ·ç›¸å…³ API å°è£…ï¼ˆ`api/user.ts`ï¼‰
- [x] åœ¨ `authStore` ä¸­å®ç°ç”¨æˆ·ä¿¡æ¯æ›´æ–°æ–¹æ³•

#### 1.5 æ–‡æ¡£æ¨¡å—ï¼ˆåŸºç¡€æ¨¡å—ï¼‰

**1.5.1 åç«¯æ–‡æ¡£æ¨¡å—**
- [x] åˆ›å»º `document` æ¨¡å—ï¼ˆdocument.module.tsã€document.controller.tsã€document.service.tsï¼‰
- [x] åˆ›å»ºæ–‡æ¡£ Schemaï¼ˆdocument.schema.tsï¼‰
- [x] åˆ›å»ºç‰‡æ®µ Schemaï¼ˆsegment.schema.tsï¼‰
- [x] åˆ›å»ºåŸºç¡€æ–‡æ¡£æŸ¥è¯¢æ¥å£ï¼ˆåç»­é˜¶æ®µå®Œå–„ï¼‰

#### 1.6 åŸºç¡€UIå¼€å‘
- [x] åˆ›å»ºåº”ç”¨å…¥å£æ–‡ä»¶ï¼ˆ`main.tsx`ï¼‰å¹¶é…ç½® Ant Design ConfigProvider
- [x] åˆ›å»ºæ ¹ç»„ä»¶ï¼ˆ`App.tsx`ï¼‰
- [x] é…ç½®è·¯ç”±ï¼ˆ`router/index.tsx`ï¼‰
- [x] åˆ›å»ºå¸ƒå±€ç»„ä»¶ï¼ˆ`components/Layout/Header`ã€`components/Layout/Sidebar`ï¼‰
- [x] åˆ›å»ºé¦–é¡µï¼ˆ`pages/Home/index.tsx`ï¼‰- è¾“å…¥æ¡†ç»„ä»¶ï¼ˆå ä½ï¼Œåç»­å®Œå–„ï¼‰
- [x] åˆ›å»ºé€šç”¨Loadingç»„ä»¶ï¼ˆ`components/Loading`ï¼‰
- [x] åˆ›å»ºé€šç”¨é”™è¯¯æç¤ºç»„ä»¶
- [x] å®ç°å“åº”å¼å¸ƒå±€
- [x] é…ç½®å…¨å±€æ ·å¼ï¼ˆ`assets/styles/global.css`ï¼‰

#### 1.7 é˜¿é‡Œäº‘OSSé…ç½®

**1.7.1 é˜¿é‡Œäº‘æœåŠ¡é…ç½®**
- [x] åˆ›å»ºOSS Bucketï¼ˆéœ€åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼Œè¯¦è§é…ç½®è¯´æ˜æ–‡æ¡£ï¼‰
- [x] é…ç½®OSS CORSè§„åˆ™ï¼ˆéœ€åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼Œè¯¦è§é…ç½®è¯´æ˜æ–‡æ¡£ï¼‰
- [x] åˆ›å»ºé˜¿é‡Œäº‘æœåŠ¡æ¨¡å—ï¼ˆ`modules/aliyun`ï¼‰
- [x] å®ç°OSSæœåŠ¡ï¼ˆ`oss.service.ts`ï¼‰
- [x] å®ç°æ–‡ä»¶ä¸Šä¼ å·¥å…·å‡½æ•°
- [x] å®ç°æ–‡ä»¶è®¿é—®ç­¾åç”Ÿæˆ
- [x] å®ç°æœ¬åœ°å­˜å‚¨é™çº§æ–¹æ¡ˆ

**1.7.2 çŸ­ä¿¡æœåŠ¡é…ç½®**
- [x] å®ç°çŸ­ä¿¡æœåŠ¡ï¼ˆ`sms.service.ts`ï¼‰
- [x] é…ç½®çŸ­ä¿¡æ¨¡æ¿ï¼ˆéœ€åœ¨é˜¿é‡Œäº‘æ§åˆ¶å°æ“ä½œï¼Œè¯¦è§é…ç½®è¯´æ˜æ–‡æ¡£ï¼‰
- [x] é›†æˆçŸ­ä¿¡æœåŠ¡åˆ°è®¤è¯æ¨¡å—

**äº¤ä»˜ç‰©**ï¼š
- âœ… å‰åç«¯é¡¹ç›®ç»“æ„å®Œæ•´åˆ›å»ºï¼ˆknowlens/frontend/ å’Œ knowlens/backend/ï¼‰
- âœ… å‰ç«¯ï¼šReact + Vite + Ant Design + React Router + zustand é…ç½®å®Œæˆ
- âœ… åç«¯ï¼šNest.js é¡¹ç›®ç»“æ„ + Swagger + CORS + Cookie é…ç½®å®Œæˆ
- âœ… MongoDBæ•°æ®åº“è¿æ¥å’Œæ‰€æœ‰Schemaæ¨¡å‹åˆ›å»ºå®Œæˆï¼ˆUserã€Documentã€Segmentã€KnowledgePointã€Insightã€SmsCodeï¼‰
- âœ… Redisé…ç½®å®Œæˆï¼ˆæœ¬åœ°å¼€å‘ç¯å¢ƒï¼‰
- âœ… BullMQåŸºç¡€é…ç½®å®Œæˆ
- âœ… åŸºç¡€æ¨¡å—åˆ›å»ºå®Œæˆï¼ˆauthã€userã€documentã€aliyunï¼‰
- âœ… ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºå·éªŒè¯ç ç™»å½•
- âœ… ç™»å½•å¼¹çª—ç»„ä»¶å®Œæˆ
- âœ… é¦–é¡µåŸºç¡€UIå®Œæˆï¼ˆå ä½ï¼‰
- âœ… é˜¿é‡Œäº‘OSSå’ŒçŸ­ä¿¡æœåŠ¡é›†æˆå®Œæˆ

---

## ç¬¬äºŒé˜¶æ®µï¼šè§†é¢‘é“¾æ¥å¤„ç†ï¼ˆç¬¬3-4å‘¨ï¼‰

### ç›®æ ‡
å®ç°è§†é¢‘URLè¾“å…¥ã€å­—å¹•æå–ã€iframeå±•ç¤º

### ä»»åŠ¡æ¸…å•

#### 2.1 è§†é¢‘æ¨¡å—åˆ›å»º
- [x] åˆ›å»ºè§†é¢‘æ¨¡å—ï¼ˆ`modules/video`ï¼‰
- [x] åˆ›å»ºè§†é¢‘ Controllerï¼ˆ`video.controller.ts`ï¼‰
- [x] åˆ›å»ºè§†é¢‘ Serviceï¼ˆ`video.service.ts`ï¼‰
- [x] åˆ›å»ºè§†é¢‘æäº¤ DTOï¼ˆ`dto/submit-video.dto.ts`ï¼‰
- [x] å®ç°è§†é¢‘æäº¤æ¥å£ï¼ˆ`POST /api/video/submit`ï¼‰
  - æ¥æ”¶è§†é¢‘URL
  - åˆ›å»ºæ–‡æ¡£è®°å½•ï¼ˆstatus: 'processing'ï¼‰
  - æŠ•é€’ä»»åŠ¡åˆ°è§†é¢‘å¤„ç†é˜Ÿåˆ—
  - è¿”å›documentIdå’ŒçŠ¶æ€

#### 2.2 è§†é¢‘URLè§£æä¸æœåŠ¡
- [x] åˆ›å»º YouTube æœåŠ¡ï¼ˆ`services/youtube.service.ts`ï¼‰
- [x] åˆ›å»º Bç«™æœåŠ¡ï¼ˆ`services/bilibili.service.ts`ï¼‰
- [x] å®ç°YouTube URLè§£æï¼ˆæå–video_idï¼‰
- [x] å®ç°Bç«™URLè§£æï¼ˆBVå·/avå·è½¬æ¢ï¼‰
- [x] åˆ›å»ºè§†é¢‘ä¿¡æ¯è·å–API (`GET /api/video/info`)
- [x] è·å–è§†é¢‘æ ‡é¢˜ã€æ—¶é•¿ç­‰å…ƒæ•°æ®

#### 2.3 å­—å¹•è·å–
- [x] é›†æˆ `youtube-transcript` åº“
- [x] åœ¨ YouTube æœåŠ¡ä¸­å®ç°å­—å¹•è·å–æ–¹æ³•ï¼ˆä¼˜å…ˆå®˜æ–¹å­—å¹•ï¼‰
- [x] åœ¨ Bç«™æœåŠ¡ä¸­å®ç°å­—å¹•è·å–APIè°ƒç”¨
- [x] å¤„ç†å¤šè¯­è¨€å­—å¹•ï¼ˆä¼˜å…ˆä¸­æ–‡ï¼‰
- [x] è§£æå­—å¹•ä¸ºå¸¦æ—¶é—´æˆ³çš„segments

#### 2.5 è¯­éŸ³è¯†åˆ«å…œåº•
- [x] åˆ›å»ºç§‘å¤§è®¯é£æœåŠ¡ï¼ˆ`services/xfyun.service.ts`ï¼‰
- [x] å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆyt-dlpï¼‰
- [x] é›†æˆ `@distube/yt-dlp` npm åŒ…ï¼ˆå¯é€‰ï¼Œæˆ–ç›´æ¥ä½¿ç”¨ç³»ç»Ÿå‘½ä»¤ï¼‰
- [x] å®ç°éŸ³é¢‘æå–æœåŠ¡ï¼ˆ`xfyunService.extractAudio`ï¼‰
  - ä½¿ç”¨ yt-dlp ä»è§†é¢‘é“¾æ¥æå–éŸ³é¢‘ï¼ˆM4Aæ ¼å¼ï¼‰
  - ä¿å­˜åˆ°ä¸´æ—¶ç›®å½•ï¼ˆ`./temp/audio`ï¼‰
- [x] é›†æˆç§‘å¤§è®¯é£å½•éŸ³æ–‡ä»¶è½¬å†™ API
  - å®ç°éŸ³é¢‘ä¸Šä¼ ï¼ˆ`uploadAudio`ï¼‰
  - å®ç°è½®è¯¢è·å–ç»“æœï¼ˆ`pollTranscriptResult`ï¼‰
  - å®ç°ç»“æœè§£æï¼ˆ`parseTranscriptResult`ï¼‰
- [x] å®ç°ä¸´æ—¶æ–‡ä»¶æ¸…ç†ï¼ˆ`cleanupAudio`ï¼‰
- [x] å°†è½¬å†™ç»“æœæ ¼å¼åŒ–ä¸º segmentsï¼ˆåŒ…å«æ—¶é—´æˆ³ï¼‰

#### 2.7 å¼‚æ­¥ä»»åŠ¡ç³»ç»Ÿ
- [x] åˆ›å»ºè§†é¢‘å¤„ç†é˜Ÿåˆ—ï¼ˆ`video-queue`ï¼‰
- [x] åˆ›å»º `VideoProcessor`ï¼ˆ`processors/video.processor.ts`ï¼‰
- [x] åœ¨ VideoProcessor ä¸­æ³¨å…¥ MoonshotService
- [x] å®ç° `processVideoJob` ä»»åŠ¡å¤„ç†é€»è¾‘
  - è·å–å­—å¹•æˆ–è½¬å½•éŸ³é¢‘
  - è°ƒç”¨ MoonshotService.formatTranscript è§„æ•´å­—å¹•
  - ä¿å­˜segmentsåˆ°æ•°æ®åº“
- [x] å®ç°ä»»åŠ¡çŠ¶æ€è½®è¯¢API (`GET /api/document/:id/status`)
- [x] å®ç°ä»»åŠ¡é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶
- [x] å®ç°ä»»åŠ¡è¿›åº¦æ›´æ–°åŠŸèƒ½

#### 2.8 æ•°æ®å­˜å‚¨
- [x] åœ¨ document æ¨¡å—ä¸­å®ç°æ–‡æ¡£æŸ¥è¯¢æ¥å£
- [x] å®ç°æ–‡æ¡£æŸ¥è¯¢API (`GET /api/document/:id`)
- [x] å®ç°æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢API (`GET /api/document/list`)
- [x] ä¿å­˜è§†é¢‘å…ƒæ•°æ®åˆ°documentsè¡¨
- [x] ä¿å­˜segmentsåˆ°æ•°æ®åº“

#### 2.9 å‰ç«¯APIå°è£…
- [x] åˆ›å»ºæ–‡æ¡£ç›¸å…³ API å°è£…ï¼ˆ`api/document.ts`ï¼‰
- [x] åˆ›å»ºè§†é¢‘ç›¸å…³ API å°è£…ï¼ˆ`api/video.ts`ï¼‰
- [x] å®ç°æ–‡æ¡£æŸ¥è¯¢APIè°ƒç”¨
- [x] å®ç°æ–‡æ¡£çŠ¶æ€è½®è¯¢APIè°ƒç”¨
- [x] å®ç°è§†é¢‘æäº¤APIè°ƒç”¨
- [x] åˆ›å»º useDocument Hookï¼ˆ`hooks/useDocument.ts`ï¼‰
- [x] åˆ›å»º usePolling Hookï¼ˆ`hooks/usePolling.ts`ï¼‰

#### 2.10 å‰ç«¯å¼€å‘
- [x] é¦–é¡µï¼šå®ç°è§†é¢‘URLè¾“å…¥è¡¨å•
- [x] å®ç°URLæ ¼å¼éªŒè¯
- [x] æäº¤åè°ƒç”¨è§†é¢‘æäº¤API
- [x] æäº¤åè·³è½¬åˆ°ç»“æœé¡µï¼ˆæ˜¾ç¤ºå¤„ç†ä¸­çŠ¶æ€ï¼‰
- [x] åˆ›å»ºè§†é¢‘ç»“æœé¡µè·¯ç”± (`/document/:id`)
- [x] åˆ›å»ºè§†é¢‘ç»“æœé¡µç»„ä»¶ï¼ˆ`pages/Document/VideoDocument.tsx`ï¼‰
- [x] å®ç°ä»»åŠ¡çŠ¶æ€è½®è¯¢ï¼ˆä½¿ç”¨ usePolling Hookï¼‰
- [x] å·¦ä¸Šè§’ï¼šå®ç°YouTube/Bç«™iframeåµŒå…¥
- [x] å·¦ä¸‹è§’ï¼šå±•ç¤ºè§†é¢‘åŸæ–‡ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
- [x] å³ä¾§ï¼šæš‚æ—¶æ˜¾ç¤ºå ä½å†…å®¹

**äº¤ä»˜ç‰©**ï¼š
- âœ… ç”¨æˆ·å¯è¾“å…¥YouTube/Bç«™URL
- âœ… ç³»ç»Ÿè‡ªåŠ¨æå–å­—å¹•æˆ–è½¬å½•éŸ³é¢‘
- âœ… è§†é¢‘ç»“æœé¡µå¯æ’­æ”¾è§†é¢‘+æŸ¥çœ‹åŸæ–‡

---

## ç¬¬ä¸‰é˜¶æ®µï¼šçŸ¥è¯†ç‚¹æç‚¼ï¼ˆç¬¬5å‘¨ï¼‰

### ç›®æ ‡
å®ç°åŸºäºMoonshot Kimiçš„çŸ¥è¯†ç‚¹è‡ªåŠ¨æç‚¼

### ä»»åŠ¡æ¸…å•

#### 3.1 Moonshot APIé›†æˆ
- [x] æ³¨å†ŒMoonshotè´¦å·å¹¶è·å–API Key
- [x] åˆ›å»º MoonshotServiceï¼ˆ`common/services/moonshot.service.ts`ï¼‰
- [x] å®‰è£… `openai` SDKï¼ˆMoonshot å…¼å®¹ OpenAI SDKï¼‰
- [x] é…ç½® Moonshot API å®¢æˆ·ç«¯ï¼ˆbaseURLã€API Keyï¼‰
- [x] å°è£… Moonshot API è°ƒç”¨å‡½æ•°
- [x] é…ç½®è¶…æ—¶å’Œé‡è¯•ç­–ç•¥
- [x] å®ç°é”™è¯¯å¤„ç†å’Œé™çº§æ–¹æ¡ˆ
- [x] å®ç°çŸ¥è¯†ç‚¹æç‚¼æ–¹æ³•ï¼ˆ`extractKnowledgePoints`ï¼‰
- [ ] å®ç°æµå¼è¾“å‡ºå¤„ç†ï¼ˆå¦‚æ”¯æŒï¼‰

**è¯´æ˜**ï¼š
- å­—å¹•æ ¼å¼è§„æ•´ä¸éœ€è¦å¤§æ¨¡å‹å‚ä¸ï¼Œç§‘å¤§è®¯é£/YouTube/Bç«™è¯†åˆ«çš„åˆ†æ®µå·²ç»è¶³å¤Ÿå¥½ï¼Œç›´æ¥ä½¿ç”¨åŸå§‹è¯†åˆ«ç»“æœ
- Moonshot API ä¸»è¦ç”¨äºçŸ¥è¯†ç‚¹æç‚¼åŠŸèƒ½

#### 3.2 Promptå·¥ç¨‹
- [x] è®¾è®¡çŸ¥è¯†ç‚¹æç‚¼çš„System Prompt
- [x] è®¾è®¡ç”¨æˆ·Promptæ¨¡æ¿ï¼ˆåŒ…å«content_textï¼‰
- [x] å®šä¹‰è¾“å‡ºç»“æ„ï¼ˆJSON Schemaï¼‰
- [ ] æµ‹è¯•å¹¶ä¼˜åŒ–Promptæ•ˆæœ

**Promptç¤ºä¾‹**ï¼š
```
ä½ æ˜¯ä¸€ä¸ªçŸ¥è¯†æç‚¼ä¸“å®¶ã€‚è¯·ä»ä»¥ä¸‹å†…å®¹ä¸­æç‚¼å‡º3-8ä¸ªæ ¸å¿ƒçŸ¥è¯†ç‚¹ã€‚

è¦æ±‚ï¼š
1. æ¯ä¸ªçŸ¥è¯†ç‚¹éœ€åŒ…å«ï¼štopicï¼ˆä¸»é¢˜ï¼‰ã€excerptï¼ˆåŸæ–‡æ‘˜å½•æˆ–è½»åº¦æ”¹å†™ï¼‰
2. excerptéœ€å°½é‡ä½¿ç”¨åŸæ–‡ï¼Œé•¿åº¦æ§åˆ¶åœ¨50-150å­—
3. ä¸ºæ¯ä¸ªexcerptæ ‡æ³¨å®ƒåœ¨åŸæ–‡ä¸­çš„ä½ç½®ï¼ˆsegment_idæˆ–æ—¶é—´æ®µï¼‰
4. æŒ‰é‡è¦æ€§æ’åº
5. çŸ¥è¯†ç‚¹åº”è¯¥æ˜¯ç‹¬ç«‹çš„ã€æœ‰ä»·å€¼çš„è§‚ç‚¹æˆ–ä¿¡æ¯

å†…å®¹ï¼š
{content_text}

è¯·ä»¥JSONæ ¼å¼è¾“å‡ºï¼š
[
  {
    "topic": "çŸ¥è¯†ç‚¹ä¸»é¢˜",
    "excerpt": "åŸæ–‡æ‘˜å½•",
    "segmentId": "ç‰‡æ®µID",
    "confidenceScore": 0.95,
    "displayOrder": 1
  }
]
```

#### 3.3 çŸ¥è¯†ç‚¹ç”Ÿæˆä»»åŠ¡
- [x] åˆ›å»ºçŸ¥è¯†ç‚¹æ¨¡å—ï¼ˆ`modules/knowledge`ï¼‰
- [x] åˆ›å»ºçŸ¥è¯†ç‚¹é˜Ÿåˆ—ï¼ˆ`knowledge-queue`ï¼‰
- [x] åˆ›å»º `KnowledgeProcessor`ï¼ˆ`processors/knowledge.processor.ts`ï¼‰
- [x] å®ç° `generateKnowledgePointsJob` ä»»åŠ¡å¤„ç†é€»è¾‘
- [x] åœ¨æ–‡æ¡£å¤„ç†å®Œæˆåè‡ªåŠ¨è§¦å‘çŸ¥è¯†ç‚¹ç”Ÿæˆä»»åŠ¡
- [x] è°ƒç”¨Moonshot APIè¿›è¡Œæç‚¼
- [x] è§£æè¿”å›çš„JSONç»“æœ
- [x] ä¿å­˜knowledge_pointsåˆ°æ•°æ®åº“
- [x] å…³è”source_anchoråˆ°segments
- [x] å®ç°çŸ¥è¯†ç‚¹æŸ¥è¯¢API (`GET /api/knowledge-points?documentId=xxx`)

#### 3.4 å‰ç«¯å±•ç¤º
- [x] åˆ›å»ºçŸ¥è¯†ç‚¹ç›¸å…³ API å°è£…ï¼ˆ`api/knowledge.ts`ï¼‰
- [x] è®¾è®¡çŸ¥è¯†ç‚¹å¡ç‰‡ç»„ä»¶ï¼ˆ`pages/Document/components/KnowledgeCard.tsx`ï¼‰
- [x] å®ç°å¡ç‰‡åˆ—è¡¨æ¸²æŸ“ï¼ˆå³ä¾§åŒºåŸŸï¼‰
- [x] æ˜¾ç¤ºtopicå’Œexcerpt
- [x] å³ä¸Šè§’æ·»åŠ åŸæ–‡è§’æ ‡ï¼ˆå¦‚[1]ï¼‰
- [x] å®ç°å¡ç‰‡LoadingçŠ¶æ€
- [x] å®ç°çŸ¥è¯†ç‚¹åˆ—è¡¨æŸ¥è¯¢å’Œå±•ç¤º

**äº¤ä»˜ç‰©**ï¼š
- âœ… è§†é¢‘å¤„ç†å®Œæˆåè‡ªåŠ¨ç”ŸæˆçŸ¥è¯†ç‚¹
- âœ… çŸ¥è¯†ç‚¹ä»¥å¡ç‰‡å½¢å¼å±•ç¤ºåœ¨å³ä¾§
- âœ… æ¯ä¸ªçŸ¥è¯†ç‚¹å¸¦æœ‰åŸæ–‡è§’æ ‡

---

## ç¬¬å››é˜¶æ®µï¼šåŸæ–‡è·³è½¬ä¸äº¤äº’ï¼ˆç¬¬6å‘¨ï¼‰

### ç›®æ ‡
å®ç°è§’æ ‡ç‚¹å‡»è·³è½¬ã€æ‚¬åœé¢„è§ˆåŠŸèƒ½

### ä»»åŠ¡æ¸…å•

#### 4.1 è§†é¢‘è·³è½¬
- [x] ç›‘å¬iframeçš„postMessageï¼ˆYouTube/Bç«™æ’­æ”¾å™¨æ§åˆ¶ï¼‰
- [x] å®ç° `jumpToTime(seconds)` å‡½æ•°
- [x] ç‚¹å‡»è§’æ ‡æ—¶è·³è½¬åˆ°å¯¹åº”æ—¶é—´ï¼ˆstart_time - 2sï¼‰
- [x] è‡ªåŠ¨æ’­æ”¾è§†é¢‘ï¼ˆBç«™é€šè¿‡URLå‚æ•°å®ç°ï¼‰
- [x] åœ¨åŸæ–‡åŒºåŸŸé«˜äº®å¯¹åº”æ–‡æœ¬
- [ ] YouTubeè·³è½¬ï¼ˆæš‚ä¸å®ç°ï¼‰

#### 4.2 åŸæ–‡é«˜äº®
- [x] å·¦ä¸‹è§’åŸæ–‡åˆ—è¡¨æ·»åŠ IDå®šä½
- [x] å®ç°æ»šåŠ¨åˆ°æŒ‡å®šsegment
- [x] æ·»åŠ é«˜äº®æ ·å¼ï¼ˆå¦‚é»„è‰²èƒŒæ™¯ï¼‰
- [x] 3ç§’åè‡ªåŠ¨ç§»é™¤é«˜äº®

#### 4.3 è§’æ ‡æ‚¬åœé¢„è§ˆ
- [x] åˆ›å»ºTooltipç»„ä»¶
- [x] æ‚¬åœæ—¶æ˜¾ç¤ºä¸Šä¸‹æ–‡1-2è¡Œ
- [x] æ˜¾ç¤º"è·³è½¬æ’­æ”¾"æŒ‰é’®
- [x] ä¼˜åŒ–Tooltipä½ç½®ï¼ˆé¿å…é®æŒ¡ï¼‰

#### 4.4 åŒå‘è·³è½¬
- [x] åŸæ–‡ç‚¹å‡»æŸæ®µæ–‡å­—æ—¶ï¼Œé«˜äº®å¯¹åº”çŸ¥è¯†ç‚¹
- [x] å®ç°åŸæ–‡æ®µè½åˆ°çŸ¥è¯†ç‚¹çš„æ˜ å°„å…³ç³»

**äº¤ä»˜ç‰©**ï¼š
- âœ… ç‚¹å‡»è§’æ ‡å¯è·³è½¬åˆ°è§†é¢‘å¯¹åº”æ—¶åˆ»
- âœ… åŸæ–‡è‡ªåŠ¨æ»šåŠ¨å¹¶é«˜äº®
- âœ… æ‚¬åœè§’æ ‡æ˜¾ç¤ºé¢„è§ˆ

---

## ç¬¬äº”é˜¶æ®µï¼šæ´å¯ŸæŒ‰éœ€ç”Ÿæˆï¼ˆç¬¬7å‘¨ï¼‰

### ç›®æ ‡
å®ç°çŸ¥è¯†ç‚¹çš„æ·±åº¦æ´å¯Ÿç”ŸæˆåŠŸèƒ½

### ä»»åŠ¡æ¸…å•

#### 5.1 æ´å¯Ÿç”ŸæˆAPI
- [ ] åˆ›å»ºæ´å¯Ÿæ¨¡å—ï¼ˆ`modules/insight`ï¼‰
- [ ] åˆ›å»ºæ´å¯Ÿ Controllerï¼ˆ`insight.controller.ts`ï¼‰
- [ ] åˆ›å»ºæ´å¯Ÿ Serviceï¼ˆ`insight.service.ts`ï¼‰
- [ ] åˆ›å»ºæ´å¯Ÿç”Ÿæˆ DTOï¼ˆ`dto/generate-insight.dto.ts`ï¼‰
- [ ] åœ¨ MoonshotService ä¸­æ·»åŠ æ´å¯Ÿç”Ÿæˆæ–¹æ³•
- [ ] å®ç° `/api/insight/generate` æ¥å£ï¼ˆ`POST /api/insight/generate`ï¼‰
- [ ] æ¥æ”¶å‚æ•°ï¼škp_id, force_regenerateï¼ˆå¯é€‰ï¼Œé»˜è®¤falseï¼‰
- [ ] æŸ¥è¯¢æ•°æ®åº“ï¼ˆé€šè¿‡ knowledgePointId æŸ¥è¯¢ insights è¡¨ï¼‰
- [ ] å¦‚æœå·²å­˜åœ¨ä¸”ä¸å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼Œç›´æ¥è¿”å›å·²æœ‰æ´å¯Ÿ
- [ ] å¦‚æœä¸å­˜åœ¨æˆ–å¼ºåˆ¶é‡æ–°ç”Ÿæˆï¼Œè°ƒç”¨Moonshotç”Ÿæˆ
- [ ] ä¿å­˜æ´å¯Ÿç»“æœåˆ°insightsè¡¨ï¼ˆé‡æ–°ç”Ÿæˆæ—¶è¦†ç›–æ—§æ•°æ®ï¼‰
- [ ] è¿”å›ç»“æ„åŒ–æ•°æ®ï¼ˆlogic, hidden_info, extension_optionalï¼‰

#### 5.2 Promptå·¥ç¨‹
- [ ] è®¾è®¡æ´å¯Ÿç”Ÿæˆçš„Prompt
- [ ] åŒ…å«çŸ¥è¯†ç‚¹å†…å®¹+ä¸Šä¸‹æ–‡æ®µè½
- [ ] å®šä¹‰è¾“å‡ºç»“æ„ï¼ˆä¸‰æ®µå¼ï¼šé€»è¾‘æ¼”ç»ã€éšå«ä¿¡æ¯ã€å»¶ä¼¸æ€è€ƒï¼‰

**Promptç¤ºä¾‹**ï¼š
```
ä½ æ˜¯ä¸€ä¸ªæ·±åº¦æ€è€ƒä¸“å®¶ã€‚è¯·é’ˆå¯¹ä»¥ä¸‹çŸ¥è¯†ç‚¹ç”Ÿæˆæ´å¯Ÿã€‚

çŸ¥è¯†ç‚¹ï¼š
{topic}
{excerpt}

åŸæ–‡ä¸Šä¸‹æ–‡ï¼š
{context_before}
{excerpt}
{context_after}

è¯·ç”Ÿæˆï¼š
1. logicï¼šè¿™ä¸ªçŸ¥è¯†ç‚¹èƒŒåçš„é€»è¾‘ã€åŸå› æˆ–è¶‹åŠ¿ï¼ˆ200å­—ä»¥å†…ï¼‰
2. hidden_infoï¼šä½œè€…æœªç›´æ¥è¯´æ˜ä½†éšå«çš„ä¿¡æ¯ï¼ˆ150å­—ä»¥å†…ï¼‰
3. extension_optionalï¼šå¯ä»¥è¿›ä¸€æ­¥æ¢ç´¢çš„æ–¹å‘å’Œç›¸å…³è®®é¢˜ï¼ˆ150å­—ä»¥å†…ï¼‰

è¦æ±‚ï¼š
- åˆ†æè¦æ·±å…¥ï¼Œé¿å…æµ…å±‚å¤è¿°
- é€»è¾‘è¦æ¸…æ™°ï¼Œæœ‰ç†æœ‰æ®
- å»¶ä¼¸è¦æœ‰å¯å‘æ€§

ä»¥JSONæ ¼å¼è¾“å‡ºï¼š
{
  "logic": "...",
  "hiddenInfo": "...",
  "extensionOptional": "..."
}
```

#### 5.3 å­˜å‚¨ç­–ç•¥ï¼ˆMVPé˜¶æ®µä½¿ç”¨æ•°æ®åº“ï¼‰
- [ ] ä¸€ä¸ªçŸ¥è¯†ç‚¹åªæœ‰ä¸€ä¸ªæ´å¯Ÿï¼ˆä¸€å¯¹ä¸€å…³ç³»ï¼‰
- [ ] é€šè¿‡ knowledgePointId åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢æ˜¯å¦å·²ç”Ÿæˆ
- [ ] å·²ç”Ÿæˆåˆ™ç›´æ¥è¿”å›ï¼Œæ— éœ€é‡å¤è°ƒç”¨LLM
- [ ] æ”¯æŒé‡æ–°ç”Ÿæˆï¼šä¼ å…¥ force_regenerate=true æ—¶ï¼Œè¦†ç›–æ—§æ´å¯Ÿ
- [ ] **æ³¨æ„**ï¼šæ´å¯Ÿæ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œä¸éœ€è¦å®šæ—¶æ¸…ç†
- [ ] **æ³¨æ„**ï¼šMVPé˜¶æ®µä½¿ç”¨MongoDBå­˜å‚¨ï¼Œæ— éœ€Redisç¼“å­˜ï¼›åç»­å¯ä¼˜åŒ–ä¸ºRedisç¼“å­˜

#### 5.4 å‰ç«¯äº¤äº’
- [ ] åˆ›å»ºæ´å¯Ÿç›¸å…³ API å°è£…ï¼ˆ`api/insight.ts`ï¼‰
- [ ] åˆ›å»ºæ´å¯Ÿå¡ç‰‡ç»„ä»¶ï¼ˆ`pages/Document/components/InsightCard.tsx`ï¼‰
- [ ] åœ¨çŸ¥è¯†ç‚¹å¡ç‰‡ä¸­é›†æˆæ´å¯ŸåŠŸèƒ½ï¼š
  - çŸ¥è¯†ç‚¹å¡ç‰‡çŠ¶æ€åˆ¤æ–­ï¼š
    - å¦‚æœæœªç”Ÿæˆæ´å¯Ÿï¼šæ˜¾ç¤º"ç”Ÿæˆ"æŒ‰é’®
    - å¦‚æœå·²ç”Ÿæˆæ´å¯Ÿï¼šæ˜¾ç¤º"å±•å¼€"æŒ‰é’®
- [ ] ç‚¹å‡»"ç”Ÿæˆ"æŒ‰é’®ï¼š
  - å‘èµ·APIè¯·æ±‚ï¼ˆforce_regenerate=falseï¼‰
  - æ˜¾ç¤ºLoadingçŠ¶æ€ï¼ˆ"ç”Ÿæˆä¸­..."ï¼‰
  - ç”Ÿæˆå®Œæˆåè‡ªåŠ¨å±•å¼€æ˜¾ç¤ºæ´å¯Ÿå†…å®¹
- [ ] ç‚¹å‡»"å±•å¼€"æŒ‰é’®ï¼š
  - å±•å¼€æ˜¾ç¤ºä¸Šæ¬¡ç”Ÿæˆçš„æ´å¯Ÿå†…å®¹
  - æ´å¯Ÿå¡ç‰‡æ˜¾ç¤ºlogicã€hidden_infoã€extension
- [ ] å±•å¼€åçš„æ“ä½œï¼š
  - æ˜¾ç¤º"é‡æ–°ç”Ÿæˆ"æŒ‰é’®
  - ç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æ—¶ï¼Œå‘èµ·APIè¯·æ±‚ï¼ˆforce_regenerate=trueï¼‰
  - æ˜¾ç¤ºLoadingçŠ¶æ€ï¼ˆ"é‡æ–°ç”Ÿæˆä¸­..."ï¼‰
  - ç”Ÿæˆå®Œæˆåè¦†ç›–æ˜¾ç¤ºæ–°æ´å¯Ÿå†…å®¹
- [ ] å±•å¼€åæ˜¾ç¤º"æ”¶èµ·"æŒ‰é’®ï¼Œç‚¹å‡»åæ”¶èµ·æ´å¯Ÿå¡ç‰‡

#### 5.5 ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- [ ] å®ç°3ç§’è¶…æ—¶æç¤º
- [ ] æä¾›"ç»§ç»­ç­‰å¾…"/"åå°ç”Ÿæˆ"é€‰é¡¹
- [ ] åå°ç”Ÿæˆå®Œæˆåæ˜¾ç¤ºé€šçŸ¥
- [ ] è®°å½•ç”Ÿæˆè€—æ—¶å’ŒTokenæ¶ˆè€—

**äº¤ä»˜ç‰©**ï¼š
- âœ… æœªç”Ÿæˆæ—¶æ˜¾ç¤º"ç”Ÿæˆ"æŒ‰é’®ï¼Œç‚¹å‡»åç”Ÿæˆæ´å¯Ÿ
- âœ… å·²ç”Ÿæˆæ—¶æ˜¾ç¤º"å±•å¼€"æŒ‰é’®ï¼Œç‚¹å‡»åå±•ç¤ºä¸Šæ¬¡ç”Ÿæˆçš„ç»“æœ
- âœ… å±•å¼€åå¯ç‚¹å‡»"é‡æ–°ç”Ÿæˆ"æŒ‰é’®ï¼Œè¦†ç›–ä¹‹å‰çš„æ´å¯Ÿ
- âœ… æ´å¯Ÿç»“æœç»“æ„åŒ–å±•ç¤ºï¼ˆlogicã€hidden_infoã€extensionï¼‰
- âœ… æ´å¯Ÿæ•°æ®æ°¸ä¹…ä¿å­˜ï¼Œæ— éœ€å®šæ—¶æ¸…ç†

---

## ç¬¬å…­é˜¶æ®µï¼šæ–‡æœ¬è¾“å…¥åŠŸèƒ½ï¼ˆç¬¬8å‘¨ï¼‰

### ç›®æ ‡
å®ç°çº¯æ–‡æœ¬ç²˜è´´è¾“å…¥

### ä»»åŠ¡æ¸…å•

#### 6.1 åç«¯å¤„ç†
- [ ] åœ¨ document æ¨¡å—ä¸­æ·»åŠ æ–‡æœ¬åˆ›å»ºæ¥å£
- [ ] åˆ›å»ºæ–‡æœ¬åˆ›å»º DTOï¼ˆ`dto/create-from-text.dto.ts`ï¼‰
- [ ] å®ç° `/api/document/create-from-text` æ¥å£ï¼ˆ`POST /api/document/create-from-text`ï¼‰
- [ ] æ¥æ”¶çº¯æ–‡æœ¬input
- [ ] åç«¯è¿›è¡Œæ–‡æœ¬åˆ†æ®µï¼ˆæŒ‰æ®µè½æˆ–å›ºå®šé•¿åº¦ï¼‰
- [ ] ç”Ÿæˆsegmentsï¼ˆè®°å½•char_startã€char_endï¼‰
- [ ] ä¿å­˜åˆ°documentså’Œsegmentsè¡¨
- [ ] è§¦å‘çŸ¥è¯†ç‚¹æç‚¼ä»»åŠ¡ï¼ˆæŠ•é€’åˆ° knowledge-queueï¼‰

#### 6.2 å‰ç«¯å¼€å‘
- [ ] é¦–é¡µæ·»åŠ "ç²˜è´´æ–‡æœ¬"tab
- [ ] å®ç°æ–‡æœ¬è¾“å…¥æ¡†ï¼ˆtextareaï¼‰
- [ ] å­—æ•°ç»Ÿè®¡å’Œé™åˆ¶ï¼ˆå¦‚10ä¸‡å­—ä»¥å†…ï¼‰
- [ ] æäº¤ååˆ›å»ºæ–‡æ¡£å¹¶è·³è½¬

#### 6.3 ç»“æœé¡µå±•ç¤º
- [ ] åˆ›å»ºæ–‡æœ¬ç»“æœé¡µï¼ˆæˆ–å¤ç”¨è§†é¢‘é¡µå¸ƒå±€ï¼‰
- [ ] å·¦ä¾§ï¼šæ˜¾ç¤ºåŸæ–‡ï¼ˆåˆ†æ®µå±•ç¤ºï¼‰
- [ ] å³ä¾§ï¼šæ˜¾ç¤ºçŸ¥è¯†ç‚¹
- [ ] å®ç°æ–‡æœ¬è·³è½¬å’Œé«˜äº®

**äº¤ä»˜ç‰©**ï¼š
- âœ… ç”¨æˆ·å¯ç²˜è´´æ–‡æœ¬å¹¶ç”ŸæˆçŸ¥è¯†ç‚¹
- âœ… æ”¯æŒæ–‡æœ¬å†…è·³è½¬

---

## ç¬¬ä¸ƒé˜¶æ®µï¼šPDFå¤„ç†åŠŸèƒ½ï¼ˆç¬¬9å‘¨ï¼‰

### ç›®æ ‡
å®ç°PDFä¸Šä¼ ã€æ–‡æœ¬æå–ã€é¡µç å®šä½

### ä»»åŠ¡æ¸…å•

#### 7.1 PDFä¸Šä¼ 
- [ ] åˆ›å»ºPDFæ¨¡å—ï¼ˆ`modules/pdf`ï¼‰
- [ ] åˆ›å»ºPDF Controllerï¼ˆ`pdf.controller.ts`ï¼‰
- [ ] åˆ›å»ºPDF Serviceï¼ˆ`pdf.service.ts`ï¼‰
- [ ] åˆ›å»ºPDFä¸Šä¼  DTOï¼ˆ`dto/upload-pdf.dto.ts`ï¼‰
- [ ] å®ç°PDFä¸Šä¼ æ¥å£ï¼ˆ`POST /api/pdf/upload`ï¼‰
- [ ] é¦–é¡µæ·»åŠ "ä¸Šä¼ PDF"åŠŸèƒ½
- [ ] å®ç°æ–‡ä»¶é€‰æ‹©å’Œæ‹–æ‹½ä¸Šä¼ 
- [ ] æ–‡ä»¶å¤§å°é™åˆ¶ï¼ˆå¦‚50MBï¼‰
- [ ] ä¸Šä¼ åˆ°é˜¿é‡Œäº‘OSS
- [ ] ä¿å­˜æ–‡ä»¶URLåˆ°documentsè¡¨

#### 7.2 PDFæ–‡æœ¬æå–
- [ ] é€‰å®šPDFè½¬æ–‡æœ¬æ–¹æ¡ˆï¼ˆpdf-parseæˆ–é˜¿é‡Œäº‘ï¼‰
- [ ] å®‰è£… `pdf-parse` åº“
- [ ] åˆ›å»ºPDFå¤„ç†é˜Ÿåˆ—ï¼ˆ`pdf-queue`ï¼‰
- [ ] åˆ›å»º `PdfProcessor`ï¼ˆ`processors/pdf.processor.ts`ï¼‰
- [ ] å®ç° `processPdfJob` ä»»åŠ¡å¤„ç†é€»è¾‘
- [ ] æå–æ–‡æœ¬å¹¶ä¿ç•™é¡µç ä¿¡æ¯
- [ ] è®°å½•page_numberã€start_offsetã€end_offset
- [ ] ä¿å­˜segmentsåˆ°æ•°æ®åº“
- [ ] è§¦å‘çŸ¥è¯†ç‚¹æç‚¼ä»»åŠ¡ï¼ˆæŠ•é€’åˆ° knowledge-queueï¼‰

#### 7.3 PDFæŸ¥çœ‹å™¨
- [ ] é›†æˆ `react-pdf` æˆ– `@react-pdf-viewer/core`
- [ ] å·¦ä¾§å±•ç¤ºPDFåŸæ–‡ï¼ˆå¯ç¿»é¡µï¼‰
- [ ] å®ç°é¡µç è·³è½¬
- [ ] å®ç°æ–‡æœ¬é«˜äº®ï¼ˆå¦‚æ”¯æŒï¼‰

#### 7.4 PDFç»“æœé¡µ
- [ ] åˆ›å»ºPDFç»“æœé¡µè·¯ç”±
- [ ] å·¦ä¾§ï¼šPDFæŸ¥çœ‹å™¨
- [ ] å³ä¾§ï¼šçŸ¥è¯†ç‚¹åˆ—è¡¨
- [ ] ç‚¹å‡»è§’æ ‡è·³è½¬åˆ°å¯¹åº”é¡µç 

#### 7.5 åŸæ–‡å®šä½
- [ ] æ ¹æ®page_numberè·³è½¬åˆ°æŒ‡å®šé¡µ
- [ ] æ ¹æ®start_offsetæ»šåŠ¨åˆ°é¡µé¢å†…ä½ç½®
- [ ] å®ç°æ–‡æœ¬é«˜äº®ï¼ˆå¦‚æœPDFæŸ¥çœ‹å™¨æ”¯æŒï¼‰

**äº¤ä»˜ç‰©**ï¼š
- âœ… ç”¨æˆ·å¯ä¸Šä¼ PDFå¹¶æå–æ–‡æœ¬
- âœ… PDFç»“æœé¡µå¯æŸ¥çœ‹åŸæ–‡å’ŒçŸ¥è¯†ç‚¹
- âœ… æ”¯æŒé¡µç è·³è½¬

---

## ç¬¬å…«é˜¶æ®µï¼šè®°å½•é¡µé¢ä¸ä¼˜åŒ–ï¼ˆç¬¬10å‘¨ï¼‰

### ç›®æ ‡
å®Œæˆè®°å½•ç®¡ç†ã€æ€§èƒ½ä¼˜åŒ–ã€æµ‹è¯•

### ä»»åŠ¡æ¸…å•

#### 8.1 è®°å½•åˆ—è¡¨é¡µ

**8.1.1 åç«¯API**
- [ ] åœ¨ document æ¨¡å—ä¸­å®ç°è®°å½•åˆ—è¡¨æ¥å£
- [ ] å®ç°æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢API (`GET /api/document/list`)
  - æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰documents
  - æŒ‰created_atå€’åºæ’åˆ—
  - æ”¯æŒåˆ†é¡µï¼ˆpageã€pageSizeï¼‰
  - æ”¯æŒæœç´¢ï¼ˆæŒ‰æ ‡é¢˜ï¼‰
- [ ] å®ç°æ–‡æ¡£åˆ é™¤API (`DELETE /api/document/:id`)
  - åˆ é™¤æ–‡æ¡£è®°å½•
  - åŒæ­¥åˆ é™¤OSSæ–‡ä»¶ï¼ˆå¦‚æœæ˜¯PDFï¼‰
  - çº§è”åˆ é™¤ç›¸å…³segmentsã€knowledge_pointsã€insights

**8.1.2 å‰ç«¯å¼€å‘**
- [ ] åˆ›å»ºè®°å½•åˆ—è¡¨é¡µè·¯ç”± (`/records`)
- [ ] åˆ›å»ºè®°å½•åˆ—è¡¨é¡µç»„ä»¶ï¼ˆ`pages/Records/index.tsx`ï¼‰
- [ ] å®ç°æ–‡æ¡£åˆ—è¡¨æŸ¥è¯¢å’Œå±•ç¤º
- [ ] å±•ç¤ºæ–‡æ¡£æ ‡é¢˜ã€ç±»å‹ã€çŠ¶æ€ã€åˆ›å»ºæ—¶é—´
- [ ] å¤„ç†ä¸­çš„æ–‡æ¡£æ˜¾ç¤º"ç”Ÿæˆä¸­"æ ‡è¯†
- [ ] å®ç°åˆ†é¡µåŠ è½½ï¼ˆå¦‚æ¯é¡µ20æ¡ï¼‰
- [ ] å®ç°è®°å½•æœç´¢åŠŸèƒ½ï¼ˆæŒ‰æ ‡é¢˜ï¼‰
- [ ] å®ç°è®°å½•åˆ é™¤åŠŸèƒ½
- [ ] ç‚¹å‡»è®°å½•è·³è½¬åˆ°å¯¹åº”ç»“æœé¡µ

#### 8.3 æˆæœ¬æ§åˆ¶
- [ ] æ·»åŠ ç”¨æˆ·æ¯æœˆæ–‡å­—é¢åº¦é™åˆ¶ï¼ˆ1ä¸‡å­—ï¼‰
- [ ] ç»Ÿè®¡ç”¨æˆ·å·²æ¶ˆè€—å­—æ•°
- [ ] è¶…é¢æ—¶æ˜¾ç¤ºæç¤º
- [ ] æ´å¯Ÿç”Ÿæˆé™åˆ¶ï¼ˆå‰2ä¸ªå…è´¹ï¼‰
- [ ] è®°å½•æ¯æ¬¡APIè°ƒç”¨çš„Tokenæ¶ˆè€—

#### 8.4 æ€§èƒ½ä¼˜åŒ–
- [ ] å®ç°APIå“åº”ç¼“å­˜ï¼ˆMVPé˜¶æ®µå¯é€‰ï¼Œåç»­ä¼˜åŒ–ï¼‰
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆæ·»åŠ ç´¢å¼•ï¼‰
- [ ] å‰ç«¯ä»£ç åˆ†å‰²ï¼ˆæŒ‰è·¯ç”±ï¼‰
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] å®ç°éª¨æ¶å±Loading

#### 8.5 é”™è¯¯å¤„ç†
- [ ] ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- [ ] å‹å¥½çš„é”™è¯¯æç¤º
- [ ] è§†é¢‘URLæ— æ•ˆçš„å¤„ç†
- [ ] å­—å¹•è·å–å¤±è´¥çš„é™çº§æ–¹æ¡ˆ
- [ ] LLMè°ƒç”¨å¤±è´¥çš„é‡è¯•æœºåˆ¶

#### 8.6 æµ‹è¯•
- [ ] é€šè¿‡å‰ç«¯è¿›è¡Œé›†æˆæµ‹è¯•
- [ ] æµ‹è¯•å…³é”®æµç¨‹ï¼ˆç™»å½•ã€è§†é¢‘æäº¤ã€çŸ¥è¯†ç‚¹ç”Ÿæˆã€æ´å¯Ÿç”Ÿæˆï¼‰
- [ ] å¤šç§è§†é¢‘URLæµ‹è¯•ï¼ˆYouTubeã€Bç«™ï¼‰
- [ ] PDFä¸Šä¼ å’Œè§£ææµ‹è¯•
- [ ] é”™è¯¯åœºæ™¯æµ‹è¯•ï¼ˆç½‘ç»œå¤±è´¥ã€è¶…æ—¶ç­‰ï¼‰

**äº¤ä»˜ç‰©**ï¼š
- âœ… è®°å½•é¡µé¢å®Œæˆ
- âœ… æˆæœ¬æ§åˆ¶æœºåˆ¶å®æ–½
- âœ… æ€§èƒ½ä¼˜åŒ–å®Œæˆ
- âœ… æµ‹è¯•è¦†ç›–ç‡è¾¾æ ‡

---

## ğŸš€ éƒ¨ç½²ä¸Šçº¿ï¼ˆç¬¬11å‘¨ï¼‰

### ä»»åŠ¡æ¸…å•

#### éƒ¨ç½²å‡†å¤‡
- [ ] è´­ä¹°é˜¿é‡Œäº‘ECSæœåŠ¡å™¨
- [ ] é…ç½®å®‰å…¨ç»„è§„åˆ™
- [ ] å®‰è£…Dockerå’ŒDocker Compose
- [ ] é…ç½®åŸŸåå’ŒSSLè¯ä¹¦
- [ ] å®ŒæˆICPå¤‡æ¡ˆ

#### æ•°æ®åº“éƒ¨ç½²
- [ ] é€‰æ‹©MongoDBéƒ¨ç½²æ–¹æ¡ˆï¼š
  - æ–¹æ¡ˆAï¼šä½¿ç”¨ MongoDB Atlasï¼ˆæ¨èï¼Œå…è´¹å¥—é¤512MBï¼‰
  - æ–¹æ¡ˆBï¼šé˜¿é‡Œäº‘MongoDBäº‘æ•°æ®åº“ï¼ˆÂ¥150/æœˆèµ·ï¼‰
  - æ–¹æ¡ˆCï¼šè‡ªå»ºMongoDBåœ¨ECSä¸Šï¼ˆéœ€è‡ªè¡Œç»´æŠ¤ï¼‰
- [ ] åˆ›å»ºç”Ÿäº§æ•°æ®åº“å¹¶é…ç½®
- [ ] è®¾ç½®æ•°æ®åº“å¤‡ä»½ç­–ç•¥
- [ ] é…ç½®Redisï¼ˆMVPé˜¶æ®µï¼šå¯åœ¨ECSä¸Šå®‰è£…æœ¬åœ°Redisï¼›æ­£å¼è¿è¥ï¼šè´­ä¹°é˜¿é‡Œäº‘Redisï¼‰

#### åº”ç”¨éƒ¨ç½²
- [ ] ç¼–å†™Dockerfile
- [ ] ç¼–å†™docker-compose.yml
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] éƒ¨ç½² React å‰ç«¯åº”ç”¨ï¼ˆNginx æ‰˜ç®¡é™æ€æ–‡ä»¶ï¼‰
- [ ] é…ç½®Nginxåå‘ä»£ç†
- [ ] é…ç½®è‡ªåŠ¨é‡å¯

#### ç›‘æ§å‘Šè­¦
- [ ] é…ç½®é˜¿é‡Œäº‘æ—¥å¿—æœåŠ¡
- [ ] è®¾ç½®é”™è¯¯å‘Šè­¦
- [ ] é…ç½®æ€§èƒ½ç›‘æ§
- [ ] è®¾ç½®APIè°ƒç”¨é‡ç›‘æ§

---

## ğŸ“Š æŠ€æœ¯éš¾ç‚¹ä¸è§£å†³æ–¹æ¡ˆ

### 1. è§†é¢‘å­—å¹•è·å–å¯é æ€§
**éš¾ç‚¹**ï¼šYouTube/Bç«™APIä¸ç¨³å®šï¼Œå¯èƒ½è·å–å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å®ç°å¤šæ¬¡é‡è¯•æœºåˆ¶
- å­—å¹•è·å–å¤±è´¥è‡ªåŠ¨é™çº§åˆ°ç§‘å¤§è®¯é£
- æä¾›æ‰‹åŠ¨ä¸Šä¼ å­—å¹•æ–‡ä»¶åŠŸèƒ½ï¼ˆåæœŸï¼‰

### 2. è§†é¢‘iframeæ’­æ”¾å™¨æ§åˆ¶
**éš¾ç‚¹**ï¼šYouTube/Bç«™iframeçš„è·³è½¬æ§åˆ¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
- YouTubeï¼šä½¿ç”¨YouTube IFrame API
- Bç«™ï¼šä½¿ç”¨Bç«™Player APIæˆ–postMessage
- å¤‡é€‰ï¼šæä¾›æ—¶é—´æˆ³é“¾æ¥è®©ç”¨æˆ·ç‚¹å‡»è·³è½¬

### 3. LLMè°ƒç”¨æˆæœ¬æ§åˆ¶
**éš¾ç‚¹**ï¼šé¢‘ç¹è°ƒç”¨Moonshotæˆæœ¬é«˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- çŸ¥è¯†ç‚¹æç‚¼é‡‡ç”¨æ‰¹é‡ä¸€æ¬¡æ€§è°ƒç”¨
- æ´å¯ŸæŒ‰éœ€ç”Ÿæˆï¼ˆç‚¹å‡»æ‰è°ƒç”¨ï¼‰
- MVPé˜¶æ®µï¼šé€šè¿‡æ•°æ®åº“å­˜å‚¨é¿å…é‡å¤ç”Ÿæˆï¼ˆä¸€ä¸ªçŸ¥è¯†ç‚¹åªç”Ÿæˆä¸€æ¬¡æ´å¯Ÿï¼‰
- è®°å½•æ¯æ¬¡è°ƒç”¨æ¶ˆè€—ï¼Œè®¾ç½®æœˆåº¦é¢„ç®—å‘Šè­¦
- åç»­ä¼˜åŒ–ï¼šå¯å¼•å…¥Redisç¼“å­˜æå‡æ€§èƒ½

### 4. PDFæ–‡æœ¬å®šä½ç²¾åº¦
**éš¾ç‚¹**ï¼šPDFé¡µé¢å†…ç²¾ç¡®å®šä½å›°éš¾

**è§£å†³æ–¹æ¡ˆ**ï¼š
- MVPé˜¶æ®µä»…æ”¯æŒé¡µç çº§è·³è½¬
- åæœŸé›†æˆæ›´ä¸“ä¸šçš„PDFè§£ææœåŠ¡
- è€ƒè™‘å°†PDFè½¬æ¢ä¸ºHTMLåœ¨è‡ªå·±çš„æŸ¥çœ‹å™¨ä¸­å±•ç¤º

### 5. å¼‚æ­¥ä»»åŠ¡å¯é æ€§
**éš¾ç‚¹**ï¼šä»»åŠ¡é˜Ÿåˆ—å¤±è´¥ã€æœåŠ¡å™¨é‡å¯å¯¼è‡´ä»»åŠ¡ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
- BullMQè‡ªå¸¦æŒä¹…åŒ–ï¼ˆRedisï¼‰
- è®¾ç½®ä»»åŠ¡è¿‡æœŸæ—¶é—´å’Œé‡è¯•æ¬¡æ•°
- å®ç°ä»»åŠ¡çŠ¶æ€ç›‘æ§å’Œæ‰‹åŠ¨é‡è¯•åŠŸèƒ½

---

## ğŸ’° æˆæœ¬ä¼°ç®—ï¼ˆæœˆåº¦ï¼‰

### é˜¿é‡Œäº‘æœåŠ¡ï¼ˆæ—¥æ´»1000ï¼‰
| æœåŠ¡ | é…ç½® | æœˆè´¹ç”¨ |
|-----|-----|-------|
| ECS | 2æ ¸4G | Â¥100 |
| MongoDB | MongoDB Atlas å…è´¹ç‰ˆæˆ–é˜¿é‡Œäº‘ | Â¥0-150 |
| Redis | MVPé˜¶æ®µï¼šECSæœ¬åœ°Redisï¼ˆå…è´¹ï¼‰<br>æ­£å¼è¿è¥ï¼šé˜¿é‡Œäº‘Redis 1Gå†…å­˜ | Â¥0-50 |
| OSS | 50GBå­˜å‚¨ + æµé‡ | Â¥20 |
| çŸ­ä¿¡æœåŠ¡ | çº¦1000æ¡/æœˆ | Â¥50 |
| å¸¦å®½ | 5Mbps | Â¥80 |
| **å°è®¡** | | **Â¥300-450/æœˆ** |

**MongoDBæ–¹æ¡ˆé€‰æ‹©**ï¼š
- **MVPé˜¶æ®µ**ï¼šä½¿ç”¨ MongoDB Atlas å…è´¹å¥—é¤ï¼ˆ512MBå­˜å‚¨ï¼Œå…±äº«é›†ç¾¤ï¼‰- Â¥0
- **æ­£å¼è¿è¥**ï¼šå‡çº§åˆ°é˜¿é‡Œäº‘MongoDBæˆ–Atlasä»˜è´¹ç‰ˆ - Â¥150/æœˆ

### AIæœåŠ¡
| æœåŠ¡ | ç”¨é‡ä¼°ç®— | æœˆè´¹ç”¨ |
|-----|--------|-------|
| Moonshot Kimi | çŸ¥è¯†ç‚¹+æ´å¯Ÿçº¦100ä¸‡tokens | Â¥200 |
| ç§‘å¤§è®¯é£ | çº¦100å°æ—¶è§†é¢‘è½¬å½• | Â¥50 |
| **å°è®¡** | | **Â¥250/æœˆ** |

### æ€»è®¡
- **MVPé˜¶æ®µ**ï¼šçº¦ Â¥500/æœˆï¼ˆä½¿ç”¨MongoDB Atlaså…è´¹ç‰ˆ + ECSæœ¬åœ°Redisï¼‰
- **æ­£å¼è¿è¥**ï¼šçº¦ Â¥700/æœˆï¼ˆä½¿ç”¨ä»˜è´¹MongoDB + é˜¿é‡Œäº‘Redisï¼‰

---

## ğŸ“ ç¯å¢ƒå˜é‡é…ç½®

### å‰ç«¯ç¯å¢ƒå˜é‡ï¼ˆ`frontend/.env.development`ï¼‰

```env
# API åŸºç¡€è·¯å¾„
VITE_API_BASE_URL=http://localhost:3000/api

# åº”ç”¨é…ç½®
VITE_APP_TITLE=Knowlens
VITE_APP_VERSION=1.0.0
```

### å‰ç«¯ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆ`frontend/.env.production`ï¼‰

```env
# API åŸºç¡€è·¯å¾„ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
VITE_API_BASE_URL=https://api.knowlens.com/api

# åº”ç”¨é…ç½®
VITE_APP_TITLE=Knowlens
VITE_APP_VERSION=1.0.0
```

### åç«¯ç¯å¢ƒå˜é‡ï¼ˆ`backend/.env.development`ï¼‰

```env
# åº”ç”¨é…ç½®
NODE_ENV=development
PORT=3000
APP_NAME=Knowlens

# MongoDB æ•°æ®åº“
MONGODB_URI=mongodb://localhost:27017/knowlens

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0

# JWT è®¤è¯
JWT_SECRET=your-jwt-secret-key-at-least-32-characters
JWT_EXPIRES_IN=7d

# é˜¿é‡Œäº‘ OSS
ALIYUN_ACCESS_KEY_ID=your-access-key-id
ALIYUN_ACCESS_KEY_SECRET=your-access-key-secret
ALIYUN_OSS_REGION=oss-cn-hangzhou
ALIYUN_OSS_BUCKET=knowlens
ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com

# é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
ALIYUN_SMS_ACCESS_KEY_ID=your-access-key-id
ALIYUN_SMS_ACCESS_KEY_SECRET=your-access-key-secret
ALIYUN_SMS_SIGN_NAME=Knowlens
ALIYUN_SMS_TEMPLATE_CODE=SMS_xxxxxx
ALIYUN_SMS_REGION=cn-hangzhou

# Moonshot Kimi API
MOONSHOT_API_KEY=your-moonshot-api-key
MOONSHOT_BASE_URL=https://api.moonshot.cn/v1
MOONSHOT_MODEL=moonshot-v1-k2

# ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«
XFYUN_APP_ID=your-app-id
XFYUN_SECRET_KEY=your-secret-key

# BullMQ ä»»åŠ¡é˜Ÿåˆ—é…ç½®
QUEUE_REDIS_HOST=localhost
QUEUE_REDIS_PORT=6379
QUEUE_VIDEO_CONCURRENCY=3
QUEUE_PDF_CONCURRENCY=5
QUEUE_KNOWLEDGE_CONCURRENCY=2

# æ—¥å¿—é…ç½®
LOG_LEVEL=debug
LOG_DIR=./logs
```

### åç«¯ç”Ÿäº§ç¯å¢ƒå˜é‡ï¼ˆ`backend/.env.production`ï¼‰

```env
# åº”ç”¨é…ç½®
NODE_ENV=production
PORT=3000
APP_NAME=Knowlens

# MongoDB æ•°æ®åº“ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
# æ¨èä½¿ç”¨ MongoDB Atlas
MONGODB_URI=mongodb+srv://username:password@cluster.mongodb.net/knowlens?retryWrites=true&w=majority

# Redisï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
REDIS_HOST=your-redis-host
REDIS_PORT=6379
REDIS_PASSWORD=your-redis-password
REDIS_DB=0

# JWT è®¤è¯
JWT_SECRET=your-production-jwt-secret-key-please-change-this
JWT_EXPIRES_IN=7d

# é˜¿é‡Œäº‘ OSS
ALIYUN_ACCESS_KEY_ID=your-production-access-key-id
ALIYUN_ACCESS_KEY_SECRET=your-production-access-key-secret
ALIYUN_OSS_REGION=oss-cn-hangzhou
ALIYUN_OSS_BUCKET=knowlens-prod
ALIYUN_OSS_ENDPOINT=oss-cn-hangzhou.aliyuncs.com

# é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡
ALIYUN_SMS_ACCESS_KEY_ID=your-access-key-id
ALIYUN_SMS_ACCESS_KEY_SECRET=your-access-key-secret
ALIYUN_SMS_SIGN_NAME=Knowlens
ALIYUN_SMS_TEMPLATE_CODE=SMS_xxxxxx
ALIYUN_SMS_REGION=cn-hangzhou

# Moonshot Kimi API
MOONSHOT_API_KEY=your-production-moonshot-api-key
MOONSHOT_BASE_URL=https://api.moonshot.cn/v1
MOONSHOT_MODEL=moonshot-v1-k2

# ç§‘å¤§è®¯é£è¯­éŸ³è¯†åˆ«
XFYUN_APP_ID=your-production-app-id
XFYUN_SECRET_KEY=your-production-secret-key

# BullMQ ä»»åŠ¡é˜Ÿåˆ—é…ç½®
QUEUE_REDIS_HOST=your-redis-host
QUEUE_REDIS_PORT=6379
QUEUE_VIDEO_CONCURRENCY=5
QUEUE_PDF_CONCURRENCY=10
QUEUE_KNOWLEDGE_CONCURRENCY=3

# æ—¥å¿—é…ç½®
LOG_LEVEL=info
LOG_DIR=./logs

# CORS é…ç½®
CORS_ORIGIN=https://knowlens.com,https://www.knowlens.com
```

---

## ğŸ”— å…³é”®æ–‡æ¡£é“¾æ¥

### å‰ç«¯ç›¸å…³
- **React å®˜æ–¹æ–‡æ¡£**ï¼šhttps://react.dev/
- **Ant Design å®˜æ–¹æ–‡æ¡£**ï¼šhttps://ant.design/
- **React Router æ–‡æ¡£**ï¼šhttps://reactrouter.com/
- **zustand æ–‡æ¡£**ï¼šhttps://github.com/pmndrs/zustand
- **Vite å®˜æ–¹æ–‡æ¡£**ï¼šhttps://vitejs.dev/
- **Axios æ–‡æ¡£**ï¼šhttps://axios-http.com/

### åç«¯ç›¸å…³
- **Nest.js å®˜æ–¹æ–‡æ¡£**ï¼šhttps://docs.nestjs.com/
- **Nest.js ä¸­æ–‡æ–‡æ¡£**ï¼šhttps://nestjs.bootcss.com/
- **Mongoose æ–‡æ¡£**ï¼šhttps://mongoosejs.com/docs/
- **@nestjs/mongoose æ–‡æ¡£**ï¼šhttps://docs.nestjs.com/techniques/mongodb
- **BullMQ æ–‡æ¡£**ï¼šhttps://docs.bullmq.io/
- **@nestjs/bullmq æ–‡æ¡£**ï¼šhttps://docs.nestjs.com/techniques/queues
- **Passport JWT æ–‡æ¡£**ï¼šhttp://www.passportjs.org/packages/passport-jwt/

### æ•°æ®åº“
- **MongoDB å®˜æ–¹æ–‡æ¡£**ï¼šhttps://www.mongodb.com/docs/
- **MongoDB Atlas**ï¼šhttps://www.mongodb.com/cloud/atlas
- **Redis å®˜æ–¹æ–‡æ¡£**ï¼šhttps://redis.io/docs/

### AI å’Œç¬¬ä¸‰æ–¹æœåŠ¡
- **Moonshot API æ–‡æ¡£**ï¼šhttps://platform.moonshot.cn/docs
- **ç§‘å¤§è®¯é£è¯­éŸ³è½¬å†™**ï¼šhttps://www.xfyun.cn/doc/asr/lfasr/API.html
- **é˜¿é‡Œäº‘ OSS SDK**ï¼šhttps://help.aliyun.com/document_detail/32068.html
- **é˜¿é‡Œäº‘çŸ­ä¿¡æœåŠ¡**ï¼šhttps://help.aliyun.com/document_detail/101346.html

### å¼€å‘å·¥å…·
- **TypeScript å®˜æ–¹æ–‡æ¡£**ï¼šhttps://www.typescriptlang.org/docs/
- **ESLint å®˜æ–¹æ–‡æ¡£**ï¼šhttps://eslint.org/docs/
- **Prettier å®˜æ–¹æ–‡æ¡£**ï¼šhttps://prettier.io/docs/

---

## âœ… éªŒæ”¶æ ‡å‡†

### ç¬¬ä¸€é˜¶æ®µéªŒæ”¶
- [ ] é¡¹ç›®å¯ä»¥è¿è¡Œ
- [ ] ç”¨æˆ·å¯ä»¥é€šè¿‡æ‰‹æœºéªŒè¯ç ç™»å½•
- [ ] MongoDBè¿æ¥æˆåŠŸï¼Œæ‰€æœ‰Collection Schemaå®šä¹‰å®Œæˆ

### ç¬¬äºŒé˜¶æ®µéªŒæ”¶
- [ ] å¯è¾“å…¥YouTubeå’ŒBç«™URL
- [ ] è‡ªåŠ¨è·å–å­—å¹•æˆ–è½¬å½•éŸ³é¢‘
- [ ] è§†é¢‘ç»“æœé¡µå¯æ’­æ”¾å’ŒæŸ¥çœ‹åŸæ–‡

### ç¬¬ä¸‰é˜¶æ®µéªŒæ”¶
- [ ] è‡ªåŠ¨ç”ŸæˆçŸ¥è¯†ç‚¹
- [ ] çŸ¥è¯†ç‚¹ä»¥å¡ç‰‡å½¢å¼å±•ç¤º
- [ ] æ¯ä¸ªçŸ¥è¯†ç‚¹æœ‰åŸæ–‡è§’æ ‡

### ç¬¬å››é˜¶æ®µéªŒæ”¶
- [ ] ç‚¹å‡»è§’æ ‡è§†é¢‘è·³è½¬åˆ°å¯¹åº”æ—¶é—´
- [ ] åŸæ–‡è‡ªåŠ¨æ»šåŠ¨å’Œé«˜äº®
- [ ] æ‚¬åœè§’æ ‡æ˜¾ç¤ºé¢„è§ˆ

### ç¬¬äº”é˜¶æ®µéªŒæ”¶
- [ ] ç‚¹å‡»"æ´å¯Ÿ"ç”Ÿæˆæ·±åº¦è§£æ
- [ ] æ´å¯Ÿå†…å®¹ç»“æ„åŒ–å±•ç¤º
- [ ] å®ç°é¿å…é‡å¤ç”Ÿæˆæœºåˆ¶ï¼ˆæ•°æ®åº“å­˜å‚¨ï¼‰

### ç¬¬å…­é˜¶æ®µéªŒæ”¶
- [ ] å¯ç²˜è´´æ–‡æœ¬å¹¶ç”ŸæˆçŸ¥è¯†ç‚¹

### ç¬¬ä¸ƒé˜¶æ®µéªŒæ”¶
- [ ] å¯ä¸Šä¼ PDFå¹¶æå–æ–‡æœ¬
- [ ] PDFç»“æœé¡µå¯æŸ¥çœ‹å’Œè·³è½¬

### ç¬¬å…«é˜¶æ®µéªŒæ”¶
- [ ] è®°å½•é¡µé¢å®Œæ•´åŠŸèƒ½
- [ ] æˆæœ¬æ§åˆ¶æœºåˆ¶ç”Ÿæ•ˆ
- [ ] æ€§èƒ½è¾¾æ ‡

---

## ğŸ“ åç»­æ”¯æŒ

å®Œæˆå¼€å‘åå»ºè®®ï¼š
1. é‚€è¯·10-20åç§å­ç”¨æˆ·å†…æµ‹
2. æ”¶é›†åé¦ˆå¹¶è¿­ä»£ä¼˜åŒ–
3. å‡†å¤‡è¿è¥å’Œæ¨å¹¿ææ–™
4. è®¾ç½®ç”¨æˆ·åé¦ˆæ¸ é“
5. åˆ¶å®šè¿ç»´å’Œç›‘æ§æ–¹æ¡ˆ

---

